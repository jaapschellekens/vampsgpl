  <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
           "http://www.w3.org/TR/REC-html40/loose.dtd"><HTML>
<META NAME="GENERATOR" CONTENT="TtH 2.00">
                                                                    
<title> \vamps, a Vegetation-AtMosphere-Plant-Soil water model</title>
 
<H1 align=center> Vamps, a Vegetation-AtMosphere-Plant-Soil water model </H1>

<H3 align=center>J. Schellekens<br><tt>schj@geo.vu.nl</tt><br>
For version: <tt>0.99c</tt>&nbsp;<tt>Alpha</tt> </H3>

<p>
<font size="-1">
<pre>
/* Copyright   (C)   1996 Jaap Schellekens.     This   program is free
 * software; you can redistribute it and/or modify  it under the terms
 * of the GNU General Public License as published by the Free Software
 * Foundation;   either version  2,  or   (at your  option) any  later
 * version.  This program  is distributed in  the hope that it will be
 * useful, but WITHOUT ANY WARRANTY; without even the implied warranty
 * of MERCHANTABILITY or FITNESS  FOR  A PARTICULAR PURPOSE.  See  the
 * GNU General   Public License  for more  details.    You should have
 * received a  copy of the GNU  General Public License along with this
 * program; see the file COPYING.  If not,  write to the Free Software
 * Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
 *
 * (C) Jaap Schellekens
 * Faculty of Earth Sciences,  Vrije Universiteit
 * De Boelelaan 1085,  1081 HV Amsterdam
 * The Netherlands
 * E-mail: schj@geo.vu.nl or schj@xs4all.nl
 *
 * Parts of this program with permission derived from swap/swatr.
 *
 *    Author : Jan G. Wesseling
 *                      Correspondence
 *      This program uses the ideas and experiences of various
 *      researchers at the Winand Staring Centre and the Wageningen
 *      Agricultural University. Currently the program is maintained
 *      and documented in cooperation by :
 *      Dept. of Agrohydrology             Dept. of Water Resources
 *      Winand Staring Centre              Wageningen Agricultural 
 					   University
 *      Marijkeweg 11/22                   Nieuwe Kanaal 11
 *      6700 AC  Wageningen                6709 PA  Wageningen
 *       The Netherlands                    The Netherlands
 *      Fax: +31 8370 24812                Fax: +31 8370 84885
 *
 *      Feedback from the users of the program is highly appreciated.
 *
 *                      Disclaimer
 *      The user of SWAP 1993 accepts and uses the program as it is, at
 *      the user's own risk, relying solely upon his/her own
 *      inspection of the program material without reliance upon
 *      other descriptions.
 *      In no event will the Winand Staring Centre or the Agricultural 
 *      University, or their individual staff members, be liable 
 *      for any incidental or consequential damage attributed
 *      to the use of this program.  
 *	
 *	Some functionality of Vamps is derived from slash by R. Venneker
 */
</pre>
</font>
<p>
This  Vamps&nbsp;manual was edited with emacs and typeset using L<sup>A</sup>T<sub>E</sub>X2e&nbsp;on a
i548 type computer running Linux. The final printout was made on a HP
Laser jet 4 after converting the dvips output to hpcl using
ghostscript.

<p>
      <H1><A NAME="tth_chAp1">
Chapter 1     </A><br>Introduction</H1>
 Vamps&nbsp;is a one-dimensional water balance model for soils covered by
forest, agricultural crop or bare land particularly suited for use
in tropical environments.   Vamps&nbsp;can be used as a complete forest
hydrological model or as a tool to determine just one or more parameters
(e.g. calculate interception using Gash' model).  Vamps&nbsp;was designed to
be extensible. At the same time the model should be simple to operate. The
model is therefore build in a modular fashion and is equipped with
a simple C-like scripting language.  Features such as  variable time
steps and the ability to select modules allow the model to be used in
both data-rich and data-poor environments.

<p>
The model has been developed as part of a collaborative project
'Hydrological modeling in a humid tropical island setting: with
special reference to The Luquillo experimental Forest, Puerto Rico'
between the International Institute of Tropical Forestry and the Vrije
Universiteit Amsterdam [].  The model is free and
distributed with complete source code. It runs on a variety of operating
systems<a href="#tthFtNtAAB" name=tthFrefAAB><sup>1</sup></a>.

<p>
The soil part of  Vamps was developed after swatr<a href="#tthFtNtAAC" name=tthFrefAAC><sup>2</sup></a>
[].

<p><A NAME="tth_tAb1.1">
</A> 
<p>

<center>
<UL>
<li> The program is written in  ansi C []

<li> Documentation for both model principles and model operation

<li> Both binaries and source code available via the World Wide Web

<li> Most parts of the model can be used separately

<li> Variable time-steps ( e.g. 0.5 seconds to two weeks )

<li> No limit to the number of soil layers 

<li> Run with Sun- os, Linux,  aix, Net- bsd,  ms-dos&nbsp;and  OS/2

<li> Includes pre- and postprocessors

<li> Simple  ascii&nbsp;input and output file format

<li> Easy extension by the users through builtin (high level) library
functions

<li> Simple to adjust to specific needs at source 
code level
</UL>
<p>
</center><br><A NAME="tab:features">
</A> <center>      Table 1.1: Selected features of the  Vamps&nbsp;model</center>
<p>
<p>
The large number of models that have been developed is an indication
that models need to be tailored or adapted for each specific application.
In order to make  Vamps&nbsp;easily extensible a C-like interpreted language
[,] allows the user to redefine builtin
functions with functions tailored to the site in question.  These features
in combination with testing on several tropical sites make the model of
particular importance to those interested in the tropics as a whole and
tropical forests in particular.

<p>
The main development goals of  Vamps&nbsp;are: <em>(i)</em> make a parameterized
model which can adequately describe the flow of water in a forested
environment (on a plot base) and <em>(ii)</em> be flexible enough to be
applied to the variety of forested environments that exist.  Due to its
flexibility it is also possible to apply  Vamps&nbsp;to plots covered with
agricultural crops or bare soils.  Furthermore the software is distributed
with complete source code and documentation to allow the user to adapt the
program to new situations and examine the program's internal operation.

<p>

<H2>Model principles</H2>
The flow of water through a forested ecosystem is shown in
Figure&nbsp;. Three pathways are generally distinguished
by which precipitation reaches the forest floor. A small fraction of
the precipitation reaches the forest floor without touching leaves or
stems. This is known as direct throughfall. Another small fraction
flows down the tree trunks as stemflow. The remaining fraction hits
the forest canopy and will leave the canopy as crown drip or evaporate
from the wet canopy depending on canopy storage capacity and shape, the
kinetic energy of the droplets and the atmosphere's evaporative demand.
Water infiltrating the soil profile can runoff laterally as saturated
or unsaturated flow, percolate to deep groundwater or is extracted
by the roots of plants or trees. If the troughfall intensity exceeds
the infiltration capacity of the topsoil, Hortonian overland flow can
occur. The top layer of the soil profile can become saturated resulting
in saturation overland flow.  Vamps&nbsp;simulates most of these fluxes
which is illustrated in

<p><A NAME="tth_fIg1.1">
</A> 
<p>

<center><a href="figure=psfig/fcycle.eps">Figure</a></center><br> <center>      Figure 1.1: Simplified diagram of the flow of water through a forested
ecosystem (after )</center>
<A NAME="fig:fcycle">
</A>
<p>
<p>
Figure&nbsp;.
The model is mainly driven by input from the atmosphere<a href="#tthFtNtAAD" name=tthFrefAAD><sup>3</sup></a>.

<p><A NAME="tth_fIg1.2">
</A> 
<p>

<center><a href="figure=psfig/vflow.eps">Figure</a></center><br> <center>      Figure 1.2: Simplified flow diagram of the  Vamps&nbsp;model</center>
<A NAME="fig:vflow">
</A>
<p>
<p>
Most of the fluxes in the model can either be calculated or given by
the user. The atmosphere, canopy and soil part of the model can be
combined or used separately. However, the strength of the model is the
ability to combine  these parts into an integrated model for the forest
hydrological cycle.

<p>
The following briefly summarizes the methods used to
calculate the water fluxes:

<DL compact>
<p>
<dt><b>Throughfall</b></dt>
	<dd> can be determined in several ways. <em>(1)</em> using 
a complete canopy water balance model based on the model developed by
 . <em>(2)</em> using one of the simpler 
analytical approaches by   or
 .  <em>(3)</em> the Leaf Area Index based
solution also used by the TOPOG model [].

<p>
<dt><b>Transpiration</b></dt>
	<dd> is commonly determined using the Penman-Monteith
equation []. Several alternative methods can be used 
as well [,,,].

<p>
<dt><b>Soil water fluxes</b></dt>
	<dd> in the unsaturated zone are determined using
Richard's equation. An adapted form of the numerical solution described
by    and   is used.
The relation between water content and pressure head can be
described in several ways 
[,,].

<p>
</DL>These fluxes can also be calculated by a user supplied method.

<p>

<H2>Other information</H2>

<p>
The latest version and other information is  available on the
Word Wide Web<a NAME="Word Wide Web10">
</a>
(http://flow.geo.vu.nl). 

<p>
 <br><H1>Part 1   <br>Model description</H1><br>

<p>
      <H1><A NAME="tth_chAp2">
Chapter 2     </A><br>Introduction</H1>
This part of the manual will describe the principles on which  Vamps&nbsp;was based.  If things are not explained here a reference to existing
literature is given.  If you think the manual is incorrect it might be
out of date as  Vamps&nbsp;is still being developed. The best thing is to
check the source code if you have any doubts.

<p>
The main goals when the development of  Vamps&nbsp;started were: <em>(1)</em>
make a parameterized model which can adequately describe the flow of
water in a forested environment (on a plot base) and <em>(2)</em> be
flexible enough to be able to be applied to the variety of forested
environments that exist.  However, because  Vamps&nbsp;is very flexible it
is also possible to apply  Vamps&nbsp;to plots covered with agricultural
crops or bare soils.  Also <em>(3)</em> it is the authors opinion that
(modelling) software should be distributed with complete source code
and documentation to allow the user to adapt the program to any new
situation and examine the program's internal workings.  

<p>
The flexible nature of  Vamps&nbsp;can be a bit confusing at first because
of the large amount of choices to be made. However, this manual and
the example files should be able to guide you to a successful
application of the  Vamps model.

<p>
The flow of water through a forested ecosystem is described in
Figure&nbsp;<A href="#fig:fcycle">1.1</A>. In general three pathways can be distinguished
by which precipitation reaches the forest floor. A small fraction of
the water reaches the forest floor without touching leaves or stems -
known as direct throughfall. Another - also small - fraction of the
water flows down the tree trunks as stemflow. The rest of the water
hits the forest canopy and will leave this canopy as crown drip or
evaporation from the wet canopy depending on canopy storage and shape,
kinetic energy of the droplets and the athmosphere's evaporative demand.
Water that infiltrates in the soil profile can leave this laterally as
saturated or unsaturated flow, percolate to deep groundwater or it can
be extracted by the roots of plants or trees. If the troughfall intensity
exceeds the infiltration capacity of the topsoil Hortonian overland flow
can occur. The top layer of the profile can become saturated resulting
in Saturation overland flow.  Vamps&nbsp;simulates most of these fluxes
as can be seen in Figure&nbsp;<A href="#fig:vflow">1.2</A> which shows a simplified flow
diagram of the  Vamps&nbsp;model. The model is mainly driven by input from the
atmosphere<a href="#tthFtNtAAE" name=tthFrefAAE><sup>4</sup></a>. In the
following chapters the workings of  Vamps&nbsp;and how the model simulates
each of these fluxes will be explained.

<p>
It should be noted that most fluxes in the model can either be
calculated or given by the user. The atmosphere, canopy and soil part
of the model can be combined or used separately. However, the strength
of models like  Vamps&nbsp;is their ability to combine all these to an
integrated model of the forest hydrological cycle. The canopy part in
particular is closely interwoven with the atmosphere module and is
hard to use seperate from the atmosphere part. 

<p>
      <H1><A NAME="tth_chAp3">
Chapter 3     </A><br>The modules</H1>

<p>
        <H2><A NAME="tth_sEc3.1">
3.1</A>&nbsp;&nbsp;Introduction</H2>
 Vamps&nbsp;is set up is such a way that parts of the model can be used
or disregarded depending on the user's needs and the available data.
This implies that you don't need <em>all</em> the following information.
Although the setup of the following chapters might suggest a strict
separation between the modules parts overlap and parts cannot be used
without some parts of other modules.

<p>
        <H2><A NAME="tth_sEc3.2">
3.2</A>&nbsp;&nbsp;The atmosphere</H2>
In the atmosphere module, potential transpiration, potential soil
evaporation and evaporation from a wet surface are calculated from
meteorological and vegetation parameters. Several methods can be
chosen, depending on the data available and the user's
preferences. The terms potential evaporation, actual evaporation and
evapotranspiration can lead to some confusion, particularly with the
use of models like  Vamps. Also the terms can have slightly
different meanings when different methods are used. Although this is
hardly desirable  Vamps is no exception yet. In the final version of
the model I hope to simplify all this, in the mean time most names and
units remain as quoted from the original source.

<p>
      <H3><A NAME="tth_sEc3.2.1">
3.2.1</A>&nbsp;&nbsp;Potential evaporation</H3>
Potential evaporation can be used in  Vamps to determine actual
evaporation (or evapotranspiration, depending on the method chosen) in
an other part of the model. Three methods can be used:

<p>

<OL type="1">
<li> Determine Penman E<sub>0</sub><a NAME="$E_0$32">
</a> (open water evaporation)
[,] using reflected
radiation, net-radiation, relative humidity (this is used to calculate
the vapour pressure deficit), wind-speed, temperature and incoming
radiation.

<li> Determine Penman E<sub>0</sub> using sun-ratio, relative humidity, wind-speed,
temperature and incoming radiation.

<li> Using the Makkink formula [,] which needs
incoming radiation, relative humidity, wind-speed and temperature.
</OL>
<p>
The input file settings for potential evaporation are described in
section&nbsp; on
page&nbsp;.

<p>
Penman E<sub>0</sub> is determined via:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
E<sub>0</sub> = </td><td nowrap align=center>
<font face=symbol>D</font
>R<sub>no</sub> + <font face=symbol>g</font
>E<sub>a</sub><hr NOSHADE>
 <font face=symbol>D</font
>+ <font face=symbol>g</font
><Br></td><td nowrap align=center>
</td></Table>
</td><td width=100 align=right>(3.1)</td></table></centEr>


Where:<br>

<table>
<tr><td>R<sub>no</sub></td><td>net radiation over open water [cm/day]</td>
<tr><td>E<sub>a</sub><a NAME="$E_a$32">
</a>	</td><td>aerodynamic evaporation or drying power of air [cm/day]</td>
<tr><td>E<sub>0</sub> 	</td><td>open water evaporation [cm/day]</td>
<tr><td><font face=symbol>D</font
><a NAME="$\Delta$32">
</a> </td><td>slope of the saturation vapour pressure curve</td>
<tr><td><font face=symbol>g</font
><a NAME="$\gamma$32">
</a> </td><td>psychrometer 'constant' [mbar/<sup>o</sup> K]<a href="#tthFtNtAAF" name=tthFrefAAF><sup>5</sup></a></td>
<tr><td></td></table>


<p>
The determination of E<sub>a</sub>
is described in []:

<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
E<sub>a</sub> = 2.6 (e<sub>s</sub> - e<sub>a</sub>) (1 + 0.537 u)</td></Table>
</td><td width=100 align=right>(3.2)</td></table></centEr>


Where:<br>

<table>
<tr><td>e<sub>a</sub><a NAME="$e_a$32">
</a>	</td><td>actual vapour pressure [mbar]</td>
<tr><td>e<sub>s</sub><a NAME="$e_s$32">
</a>	</td><td>vapour pressure at saturation [mbar]</td>
<tr><td>u<a NAME="$u$32">
</a>	</td><td>mean daily wind-speed at 2m</td>
<tr><td></td></table>

 Vamps&nbsp;calculates e<sub>s</sub> and e<sub>a</sub> from relative humidity and
dry bulb temperature using an equation 
described by&nbsp;.

<p>
Net radiation over open water is given by:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
R<sub>no</sub> = R<sub>s</sub> (1- <font face=symbol>a</font
>) - R<sub>nl</sub></td></Table>
</td><td width=100 align=right>(3.3)</td></table></centEr>


Where:<br>

<table>
<tr><td>R<sub>s</sub><a NAME="$R_s$32">
</a>		</td><td>incoming solar radiation </td>
<tr><td>R<sub>nl</sub><a NAME="$R_{nl}$32">
</a>	</td><td>net long-wave radiation </td>
<tr><td><font face=symbol>a</font
><a NAME="$\alpha$32">
</a>  	</td><td>albedo of open water (0.05) </td>
<tr><td></td></table>


<p>
In method 1 R<sub>nl</sub> is calculated using incoming and
reflected short-wave radiation to calculation net long-wave
radiation via:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
 R<sub>nl</sub> = R<sub>s</sub> - R<sub>net</sub> - Rs<sub>out</sub></td></Table>
</td><td width=100 align=right>(3.4)</td></table></centEr>


Where:<br>

<table>
<tr><td>R<sub>s</sub> 			</td><td>incoming solar radiation </td>
<tr><td>Rs<sub>out</sub><a NAME="$Rs_{out}$32">
</a> 	</td><td>reflected short-wave radiation </td>
<tr><td>R<sub>net</sub><a NAME="$R_{net}$32">
</a>	</td><td>net radiation</td>
<tr><td></td></table>

In method 2 sun-ratio n/N is used to calculate R<sub>nl</sub> via:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
R<sub>nl</sub> = </td><td nowrap align=center>
86400 <font face=symbol>s</font
>T<sup>4</sup> (0.56 - 0.248 <font face=symbol>Ö</font
>e) (0.1 + 0.9 n/N)<hr NOSHADE>
 <font face=symbol>l</font
><Br></td><td nowrap align=center>
</td></Table>
</td><td width=100 align=right>(3.5)</td></table></centEr>


Where:<br>

<table>
<tr><td>T<a NAME="$T$32">
</a> 	</td><td>mean daily air temperature [<sup>o</sup> K]</td>
<tr><td>e<a NAME="$e$32">
</a>	</td><td>mean daily water vapour pressure [kPa]</td>
<tr><td>n/N<a NAME="$n/N$32">
</a>	</td><td>ratio of duration of bright sunshine hours, n, 
	to the maximum possible duration of sunshine hours, N </td>
<tr><td><font face=symbol>l</font
><a NAME="$\lambda$32">
</a> </td><td>latent heat of vaporization </td>
<tr><td></td></table>


<p>
Makkink&nbsp;[] reference evaporation is calculated by:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
<font face=symbol>l</font
>E = C </td><td nowrap align=center>
<font face=symbol>D</font
><hr NOSHADE>
 <font face=symbol>D</font
>+ <font face=symbol>g</font
><Br></td><td nowrap align=center>
R<sub>s</sub></td></Table>
</td><td width=100 align=right>(3.6)</td></table></centEr>


Where:<br>

<table>
<tr><td>C<a NAME="$C$32">
</a> 	</td><td>Constant (usually 0.65)</td>
<tr><td><font face=symbol>l</font
>, E, <font face=symbol>D</font
>, <font face=symbol>g</font
>, R<sub>s</sub> </td><td>are defined as before</td>
<tr><td></td></table>


<p>
      <H3><A NAME="tth_sEc3.2.2">
3.2.2</A>&nbsp;&nbsp;Actual evapotranspiration</H3>
If you don't want to model an entire canopy (as is described in
section ) you can estimate actual evapotranspiration
with one the following three methods. The use of the canopy section
is the preferred way.

<p>

<OL type="1">
<li> Set actual evapotranspiration to be equal to potential evaporation.

<li> Multiply potential evaporation by a crop factor

<li> Calculate actual evaporation using the Penman-Monteith formula
</OL>
<p>
        <H2><A NAME="tth_sEc3.3">
3.3</A>&nbsp;&nbsp;Plants and trees</H2><A NAME="sec:canopy">
</A>

<p>
Although  Vamps&nbsp;has been set up to be able to use a multilayer
canopy, this option is untested and has been disabled in the alpha
version. At present you are stuck to one canopy layer.

<p>
At the base of this module lies the Penman-Montheith equation[].

<p>


<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
<font face=symbol>l</font
>ET = </td><td nowrap align=center>
<font face=symbol>D</font
>(R<sub>n</sub> - G) + <font face=symbol>r</font
>C<sub>p</sub> <font face=symbol>d</font
>e/r<sub>a</sub><hr NOSHADE>
 <font face=symbol>D</font
>+ <font face=symbol>g</font
>( 1 + r<sub>s</sub>/r<sub>a</sub>)<Br></td><td nowrap align=center>
</td></Table>
</td><td width=100 align=right>(3.7)</td></table></centEr>



<p>
Where:<br>

<table>
<tr><td><font face=symbol>r</font
>	</td><td>density of air </td>
<tr><td>c<sub>p</sub>	</td><td>specific heat of air </td>
<tr><td><font face=symbol>d</font
>e	</td><td>vapour pressure deficit </td>
<tr><td><font face=symbol>g</font
>	</td><td>psychrometic constant </td>
<tr><td><font face=symbol>D</font
>	</td><td>the slope of the saturation vapour pressure curve </td>
<tr><td>r<sub>s</sub>	</td><td>canopy resistance </td>
<tr><td>r<sub>a</sub>	</td><td>aerodynamic resistance</td>
<tr><td></td></table>


<p>
The program seperates wet and dry periods.  Evaporation from the wet
canopy is calculated using the Penman-Monteith equation with r<sub>s</sub> set
to zero.  During these times transpiration (and thus rootextraction)
is assumed zero.

<p>
The amount of net radiation available is determined via a simple
fraction or via an equation by  linking the
leaf area profile to absorbed radiation.

<p>
This module combines most of what has been explained before (in the
sections concerning evaporation, transpiration and interception) and
 Vamps&nbsp;work best if you use this.

<p>
      <H3><A NAME="tth_sEc3.3.1">
3.3.1</A>&nbsp;&nbsp;Interception</H3><A NAME="sec:interception">
</A>

<p>

<b>Introduction&nbsp;&nbsp;</b><a href="#tthFtNtAAG" name=tthFrefAAG><sup>6</sup></a>
Interception<a NAME="Interception33">
</a> of precipitation can comprise a large part of the water
balance in forested catchments.  Interception is defined as
[]:

<blockquote>
<p>
... the amount of rainfall retained by the vegetation and evaporated
without dripping off or running down the stem. At some point after 
precipitation ceases, all of the intercepted water will be evaporated...
</blockquote>
<p>
Note that losses in the litter layer are not included<a href="#tthFtNtAAH" name=tthFrefAAH><sup>7</sup></a>.  The balance between precipitation, evaporation and canopy
storage<a href="#tthFtNtAAI" name=tthFrefAAI><sup>8</sup></a> [] determines the amount of rainfall
interception.  As the canopy parameters can change with vegetation
type, so does the interception.

<p>
Interception of a forest canopy is generally determined by either the
water budget method or by the aerodynamic method
[].  An alternative method consists of hanging a
tree in its place in the forest and weighing it continuously. This has
the advantage that the evaporation during the storm can adequately
be determined [].

<p>
In tropical rain forest areas a great diversity of species exist. Highly
significant differences in interception storage have been found 
[,,]. This implies that
parameters probably need to be determined for each site seperately.

<p>
How interception losses can be calculated is mostly determined by the
available data. The model by  needs hourly
input, while some of it's parameters should be determined using 5 minute
values. In reality daily values are most commonly available, so
developing equations for daily values (despite the obvious limitation)
is justifiable and certainly practical []. 
 developed an analytical
variant of the Rutter model which can be used with daily input values
assuming one storm a day.

<p>
Several methods for determining interception losses can be used within
the  Vamps&nbsp;model. The choice of method is mainly governed by the
available input data. The following paragraphs present the methods
that  Vamps&nbsp;can use to determine interception losses.

<p>

<b>Gash<a NAME="Gash33">
</a>'s method&nbsp;&nbsp;</b><A NAME="par:gash">
</A>
If input data is available on a daily basis, the method described
by&nbsp; is the preferred method.  Gash's model is
based on a numerical model developed by . In
contrast to Rutter's model which is described later, it can be applied
to daily measurements assuming one storm a day. have tested both models on the same data set and found comparable
results.

<p>
In the model  P'<a NAME="$P$'33">
</a> - the  amount  of water  needed to completely
saturate the canopy [] - is defined as:

<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
P\acute = </td><td nowrap align=center>
<tabLe border=0><tr><td nowrap align=center>
-</td><td nowrap align=center>
<hr NOSHADE>
R<Br>&nbsp;<br></td><td nowrap align=center>
S</td></tabLe><hr NOSHADE>
<tabLe border=0><tr><td nowrap align=center>
</td><td nowrap align=center>
<hr NOSHADE>
E<Br>&nbsp;<br></td><td nowrap align=center>
</td></tabLe></td><td nowrap align=center>
ln</td><td align=left><font face=symbol>
é<br>ê<br>ê<br>ê<br>
ê<br>ê<br>ë
</font></td><td align=center>
1-</td><td nowrap align=center>
<tabLe border=0><tr><td nowrap align=center>
</td><td nowrap align=center>
<hr NOSHADE>
E<Br>&nbsp;<br></td><td nowrap align=center>
</td></tabLe><hr NOSHADE>
<tabLe border=0><tr><td nowrap align=center>
</td><td nowrap align=center>
<hr NOSHADE>
R<Br>&nbsp;<br></td><td nowrap align=center>
</td></tabLe></td><td nowrap align=center>
(1-p-p<sub>Tr</sub>)<sup>-1</sup></td><td align=left><font face=symbol>
ù<br>ú<br>ú<br>ú<br>
ú<br>ú<br>û
</font></td><td align=center>
</td></Table>
</td><td width=100 align=right>(3.8)</td></table></centEr>



<p>
Interception losses  for storms larger and  smaller than  P\acute are dealt
with separately. For small storms the equation becomes:

<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
E<sub>i</sub> = (1-p-p<sub>Tr</sub>) P </td></Table>
</td><td width=100 align=right>(3.9)</td></table></centEr>


while or large storms it becomes:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
E<sub>i</sub> = (1-p-p<sub>Tr</sub>) P\acute + (</td><td nowrap align=center>
<hr NOSHADE>
E<Br>&nbsp;<br></td><td nowrap align=center>
/</td><td nowrap align=center>
<hr NOSHADE>
R<Br>&nbsp;<br></td><td nowrap align=center>
) (P - P\acute)</td></Table>
</td><td width=100 align=right>(3.10)</td></table></centEr>



<p>
Where:<br>

<table>
<tr><td>[<font face=symbol>`</font
>R]<a NAME="$\overline{R}$33">
</a>  </td><td>average precipitation [mm/d]</td>
<tr><td>[<font face=symbol>`</font
>E]<a NAME="$\overline{E}$33">
</a>  </td><td>average evaporation during storms [mm/d] </td>
<tr><td>S<a NAME="$S$33">
</a> 	        </td><td>storage capacity of the canopy [mm] </td>
<tr><td>p<a NAME="$p$33">
</a>             </td><td>free throughfall coefficient </td>
<tr><td>p<sub>Tr</sub><a NAME="$p_{Tr}$33">
</a>        </td><td>stemflow coefficient </td>
<tr><td>P<a NAME="$P$33">
</a>		</td><td>precipitation [mm/d]</td>
<tr><td>E<sub>i</sub><a NAME="$E_i$33">
</a>		</td><td>interception loss [mm]</td>
<tr><td></td></table>


<p>
The interception losses from the stem are calculated for days that P <font face=symbol>³</font
> S<sub>Tr</sub>/p<sub>Tr</sub>. As this is generally small (about 2% of gross P)
it is often neglected<a href="#tthFtNtAAJ" name=tthFrefAAJ><sup>9</sup></a>.  Vamps&nbsp;can calculate The ratio of [<font face=symbol>`</font
>E]/[<font face=symbol>`</font
>R] from the
Penman-Monteith equation or use a fixed value.<a href="#tthFtNtABA" name=tthFrefABA><sup>10</sup></a>  Vamps&nbsp;also allows
the parameters S, p and p<sub>Tr</sub> to be linked to the Leaf Area
Index (LAI). If lai is defined in the <tt>interception</tt><a NAME="interception33">
</a> section of the
input file, or in the <tt>ts</tt><a NAME="ts33">
</a> section of the input file a method
described in&nbsp; is used to link these parameters to LAI.

<p>
A version of the Gash model adapted to small time-steps can also be
used in  Vamps. In this version the canopy storage (S) is
diminished with the value of the actual canopy storage at that
moment. This new value is now used to calculate P' and interception
losses.  To use this method Evaporation during that time-step is
needed as well as this is subtracted from the amount of water in the
canopy at the begin of the time-step. Results of applying this adapted
version to a test case using the normal version with daily time-steps
and the adapted version with half-hourly data, show that interception
losses as modeled with both methods did not differ more than 2%.

<p>

<b>Calder regression model<a NAME="Calder regression model33">
</a>&nbsp;&nbsp;</b>

<p>
 presented a simple regression model for interception
loss. Despite it's simplicity it could adequately describe the interception
of forests in the UK. It is defined as:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
E<sub>i</sub> = <font face=symbol>g</font
>[ 1 - exp (-<font face=symbol>d</font
>P) ]</td></Table>
</td><td width=100 align=right>(3.11)</td></table></centEr>


Where:<br>

<table>
<tr><td>E<sub>i</sub>			</td><td>Interception loss [mm/d] </td>
<tr><td>P<a NAME="$P$33">
</a>		</td><td>precipitation [mm/d] </td>
<tr><td><font face=symbol>g</font
><a NAME="$\gamma$33">
</a>	</td><td>maximum interception loss per day [mm] </td>
<tr><td><font face=symbol>d</font
><a NAME="$\delta$33">
</a>	</td><td>fitting parameter </td>
<tr><td></td></table>


<p>

<b>Interception as a fraction of LAI<a NAME="Interception as a fraction of LAI33">
</a>&nbsp;&nbsp;</b>

<p>
In this method interception is calculated as:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
E<sub>i</sub> = min (P,laifrac*LAI) </td></Table>
</td><td width=100 align=right>(3.12)</td></table></centEr>


Where:<br>

<table>
<tr><td>E<sub>i</sub>			</td><td>Interception loss [mm/d] </td>
<tr><td>P			</td><td>precipitation [mm/d] </td>
<tr><td>laifrac<a NAME="$laifrac$33">
</a>	</td><td>fraction (usually around canopy storage) </td>
<tr><td>LAI<a NAME="$LAI$33">
</a>		</td><td>leaf area index </td>
<tr><td></td></table>

This method can describe total interception rather well but fails on a
storm to storm basis (it is used in the TOPOG model
[]). The fact that it is based on LAI makes it well
suited for applications in which the canopy changes in time, although
an alternative Gash model in which the parameters S, p<sub>tr</sub> and
p are related to LAI might yield better results (see also
paragraph&nbsp;<A href="#par:gash">3.3.1</A> on page&nbsp;<A href="#par:gash">pageref</A>).

<p>

<b>Rutter's model<a NAME="Rutter's model33">
</a>&nbsp;&nbsp;</b>
 (see also ) developed
a model of interception based on the storage of water in the canopy.
The model needs hourly meteorological data plus canopy parameters as
input, although five minute data are preferred.

<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
dC/dt = P(1 - p - p<sub>Tr</sub>) - (C/S) E<sub>c</sub> - D<sub>r</sub></td></Table>
</td><td width=100 align=right>(3.13)</td></table></centEr>


Where:<br>

<table>
<tr><td>t			</td><td>time-step [hour]</td>
<tr><td>C<a NAME="$C$33">
</a>		</td><td>amount of water in the canopy</td>
<tr><td>P			</td><td>gross precipitation [mm/h] </td>
<tr><td>p			</td><td>free throughfall coefficient [-] </td>
<tr><td>p<sub>Tr</sub>		</td><td>proportion of water discharged via stem flow</td>
<tr><td>S			</td><td>canopy storage capacity [mm]</td>
<tr><td>E<sub>c</sub><a NAME="$E_c$33">
</a>		</td><td>evaporation rate from wet canopy [mm/h]</td>
<tr><td>D<sub>r</sub><a NAME="$D_r$33">
</a>		</td><td>drainage-speed from storage in canopy [mm/h] </td>
<tr><td></td></table>


<p>
The model is rather insensitive to both S and p [].

<p>
        <H2><A NAME="tth_sEc3.4">
3.4</A>&nbsp;&nbsp;The soil</H2> 

      <H3><A NAME="tth_sEc3.4.1">
3.4.1</A>&nbsp;&nbsp;Introduction</H3>
The soil module can be regarded as the core of  Vamps. The model was
developed using the  swap94 model as a framework. About 80% of
 Vamps's soil module consists of hand-translated<a href="#tthFtNtABB" name=tthFrefABB><sup>11</sup></a> Fortran code from the original  swap94 program. The
head based solution of Richard's equation using remains more or less
the same in the present version, although the solution has been
extended with a band-diagonal procedure and a (optional) step to regain
full machine precision (described in
) that can be used if a zero pivot
occurs in the tri-diagonal solution.

<p>
      <H3><A NAME="tth_sEc3.4.2">
3.4.2</A>&nbsp;&nbsp;Solving Richard's equation</H3>
The soil module solves Richards equation using a <font face=symbol>y</font
> based form of this
equation. A differential moisture capacity (C(h)) has been introduced to
have a single independent variable. This differential soil moisture capacity
is equal to the slope of the soil-moisture retension curve, d<font face=symbol>q</font
>/d<font face=symbol>y</font
>.

<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
</td><td nowrap align=center>
<font face=symbol>¶</font
><font face=symbol>y</font
><hr NOSHADE>
 <font face=symbol>¶</font
>t<Br></td><td nowrap align=center>
 = </td><td nowrap align=center>
1<hr NOSHADE>
 C(<font face=symbol>y</font
>)<Br></td><td nowrap align=center>
</td><td nowrap align=center>
<font face=symbol>¶</font
><hr NOSHADE>
 <font face=symbol>¶</font
>z<Br></td><td nowrap align=center>
</td><td align=left><font face=symbol>
é<br>ê<br>
ë
</font></td><td align=center>
 K(<font face=symbol>y</font
>) </td><td align=left><font face=symbol>
æ<br>ç<br>
è
</font></td><td align=center>
</td><td nowrap align=center>
<font face=symbol>¶</font
><font face=symbol>y</font
><hr NOSHADE>
 <font face=symbol>¶</font
>z<Br></td><td nowrap align=center>
- 1 </td><td align=left><font face=symbol>
ö<br>÷<br>
ø
</font></td><td align=center>
</td><td align=left><font face=symbol>
ù<br>ú<br>
û
</font></td><td align=center>
</td></Table>
</td><td width=100 align=right>(3.14)</td></table></centEr>



<p>
A sink term (S) has been added to accommodate water extraction by roots
and lateral flow.

<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
</td><td nowrap align=center>
<font face=symbol>¶</font
><font face=symbol>y</font
><hr NOSHADE>
 <font face=symbol>¶</font
>t<Br></td><td nowrap align=center>
 = </td><td nowrap align=center>
1<hr NOSHADE>
 C(<font face=symbol>y</font
>)<Br></td><td nowrap align=center>
</td><td nowrap align=center>
<font face=symbol>¶</font
><hr NOSHADE>
 <font face=symbol>¶</font
>z<Br></td><td nowrap align=center>
</td><td align=left><font face=symbol>
é<br>ê<br>
ë
</font></td><td align=center>
 K(<font face=symbol>y</font
>) </td><td align=left><font face=symbol>
æ<br>ç<br>
è
</font></td><td align=center>
</td><td nowrap align=center>
<font face=symbol>¶</font
><font face=symbol>y</font
><hr NOSHADE>
 <font face=symbol>¶</font
>z<Br></td><td nowrap align=center>
- 1 </td><td align=left><font face=symbol>
ö<br>÷<br>
ø
</font></td><td align=center>
</td><td align=left><font face=symbol>
ù<br>ú<br>
û
</font></td><td align=center>
- </td><td nowrap align=center>
S(<font face=symbol>y</font
>)<hr NOSHADE>
 C(<font face=symbol>y</font
>)<Br></td><td nowrap align=center>
</td></Table>
</td><td width=100 align=right>(3.15)</td></table></centEr>



<p>
Where:<br>

<table>
<tr><td><font face=symbol>y</font
>	</td><td>Suction head [cm] </td>
<tr><td>t	</td><td>time [days] </td>
<tr><td>C	</td><td>differential moisture capacity (d<font face=symbol>q</font
>/d<font face=symbol>y</font
>)</td>
<tr><td>S	</td><td>sink term</td>
<tr><td>z	</td><td>heigth [cm]</td>
<tr><td></td></table>


<p>
At present the reader is referred to  and
 for a detailed description.

<p>
 Vamps&nbsp;first estimates the largest time-step possible with the code
presented in example&nbsp;. It uses the previous dt and
a value for thetol (the maximum change in theta allowed per time-step)
to do so. This is done for all layers in the soil profile. This way the
layer in which the largest changes occur determines the maximum dt.


<pre>
/*-
 *	void timestep(int step)
 *	Calculation of timestep (dt) depending on theta  changes
 *	and new time (t)
 */
double
timestep (int step)
{
  int i;

  /* Store previous values */
  tm1 = t;
  dtm1 = dt;

  /* start with max dt */
  dt = dtmax;

  mdtheta = fabs (thetm1[0] - theta[0]);
  for (i = 0; i &lt; layers; i++)
    {
      dtheta = fabs (thetm1[i] - theta[i]);
      mdtheta = mdtheta &lt; dtheta ? dtheta : mdtheta;
    }

  if (mdtheta &lt; 1.0E-6)
    dt = dtmax;
  else
      dt = 10.0 * thetol * dtm1 / mdtheta;

  /* restrict to dtmin and dtmax */
  dt = dt &#62; dtmin ? dt : dtmin;
  dt = dt &lt; dtmax ? dt : dtmax;

return dt;
}

</pre>
&lt;td&#62;The C code used by  Vamps&nbsp;to estimate the maximum dt
<A NAME="ex:timestep">
</A>

<p>
If this produces results that are regarded as not accurate enough (set
with the <tt>thetol</tt><a NAME="thetol34">
</a> variable)  Vamps&nbsp;will perform iterations to
get the accuracy asked. If this fails dt is halved and the procedure
is started again until the accuracy is reached or dt-minimum is
reached. The maximum number of iterations is set with <tt>maxitr</tt><a NAME="maxitr34">
</a>
variable while the minimum allowed dt is set using the <tt>dtmin</tt><a NAME="dtmin34">
</a>
variable.

<p>
      <H3><A NAME="tth_sEc3.4.3">
3.4.3</A>&nbsp;&nbsp;Relation between Theta, <font face=symbol>y</font
>  and  K<sub>unsat</sub></H3> 
 Vamps&nbsp;was first developed using the equations by 
 (see also ).
This is still the default method. For extra speed and flexibility
 Vamps&nbsp;can also read tables which describe these relations. This
means that the user can use any method available<a href="#tthFtNtABC" name=tthFrefABC><sup>12</sup></a>. At present  Vamps&nbsp;can only generate tables for the van
Genuchten method. However, it can read tables generated by the <tt>
topog_soil</tt> program [] or user made tables, thus
extending the amount of models for the theta vs <font face=symbol>y</font
> that can be
used to anything the user can imagine.  The following is derived from
the topog_soil<a href="#tthFtNtABD" name=tthFrefABD><sup>13</sup></a> manual:

<p>

<blockquote>Six different soil tables can be generated using topog_soil, the
options being:

<OL type="1">
<p>

<li> Broadbridge and White (1988)

<li> Campbell (Ross and Bristow, 1990)

<li> Campbell (SWIM model version, 1974;1985)

<li> Campbell (Ross, Williams and Bristow, 1991)

<li> van Genuchten (1980)

<li> Simplified Bucket Model soil table (1979)
</OL>
<p>
</blockquote>At present only items 1 and 5 have been tested using  Vamps.  A
description of the file format for these tables can be found in
Appendix ??.

<p>

<b>Van Genuchten&nbsp;&nbsp;</b>

<p>
 Vamps&nbsp;default and most tested method of describing the
theta versus suction- head and k<sub>unsat</sub> is base in the van
Genuchten equations [,].  The
dimensionless water content is given as:

<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
<font face=symbol>Q</font
> =  </td><td nowrap align=center>
<font face=symbol>q</font
>- <font face=symbol>q</font
><sub>r</sub><hr NOSHADE>
 <font face=symbol>q</font
><sub>s</sub> - <font face=symbol>q</font
><sub>r</sub><Br></td><td nowrap align=center>
</td></Table>
</td><td width=100 align=right>(3.16)</td></table></centEr>


Where:<br>

<table>
<tr><td><font face=symbol>q</font
><sub>s</sub>	</td><td>saturated water content </td>
<tr><td><font face=symbol>q</font
><sub>r</sub>	</td><td>residual water content</td>
<tr><td><font face=symbol>q</font
>	</td><td>actual soil water content</td>
<tr><td><font face=symbol>Q</font
>	</td><td>dimensionless soil water content</td>
<tr><td></td></table>


<p>
Then a class of <font face=symbol>Q</font
>(<font face=symbol>y</font
>) functions can be given by:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
<font face=symbol>Q</font
> =  </td><td align=left><font face=symbol>
é<br>ê<br>
ë
</font></td><td align=center>
 </td><td nowrap align=center>
1<hr NOSHADE>
 1 + (<font face=symbol>a</font
><font face=symbol>y</font
>)<sup>n</sup><Br></td><td nowrap align=center>
</td><td align=left><font face=symbol>
ù<br>ú<br>
û
</font></td><td align=center>
<font size="-1">m</font> <Br><br>
<font size="-1"></font>&nbsp;<br></td><td nowrap>
</td></Table>
</td><td width=100 align=right>(3.17)</td></table></centEr>



<p>
Where:<br>

<table>
<tr><td><font face=symbol>y</font
> 	</td><td>pressure head </td>
<tr><td><font face=symbol>a</font
>, n and m	</td><td>soil characteristic parameters </td>
<tr><td></td></table>


<p>
if m = 1 - n/m the following closed-for expression of K(<font face=symbol>Q</font
>)
can be obtained:

<p>
										
<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
<font face=symbol>Q</font
> =  </td><td align=left><font face=symbol>
ì<br>ï<br>ï<br>í<br>
ï<br>ï<br>î
</font></td><td align=center>
 </td><td nowrap><TablE border=0 align=left><tr><td nowrap align=center>
<tabLe border=0><tr><td nowrap Align=center>
</td><td nowrap align=center>
1<hr NOSHADE>
 [1+(<font face=symbol>a</font
><font face=symbol>y</font
>)<sup>n</sup>]<sup>1-1/n</sup><Br></td><td nowrap align=center>
</td></tabLe></td><td nowrap align=center>
<tabLe border=0><tr><td nowrap Align=center>
<font face=symbol>y</font
><font face=symbol> &lt; </font
> 0 </td></tabLe></TD></TR><TR><TD NOWRAP align="center" colspan=0><tabLe border=0><tr><td nowrap Align=center>
1</td></tabLe></td><td nowrap align=center>
<table><TR><TD nowrap align="center" colspan=0><font face=symbol>y</font
> <font face=symbol>³</font
> 0</td></tabLe></TD></TR></TablE>
</td><td nowrap></td></Table>
</td><td width=100 align=right>(3.18)</td></table></centEr>



<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
K = K<sub>s</sub> <font face=symbol>Q</font
><sup>1/2</sup>[ 1 - ( 1 - <font face=symbol>Q</font
><sup>n/(n-1)</sup>)<sup>1-1/n</sup>]<sup>2</sup></td></Table>
</td><td width=100 align=right>(3.19)</td></table></centEr>



<p>
The  K<sub>s</sub> <font face=symbol>Q</font
><sup>1/2</sup> part of the equation can be changed to  K<sub>s</sub><font face=symbol>Q</font
><sup>L</sup>  is which L is a fitting parameter describing the
<font face=symbol>Q</font
> to K<sub>unsat</sub> relation if you have K<sub>unsat</sub> measurements.

<p>
Values for the parameters <font face=symbol>a</font
>, n and L for most soil types in
the Netherlands can be found in . Such
values for tropical soils seem to be less common. In that case a
nonlinear regression method can be used to determine the parameters
<font face=symbol>a</font
> and n from a soil moisture retention curve
[].

<p>

<b>Clapp/Hornberger&nbsp;&nbsp;</b>
A power curve can conveniently describe the moisture characteristics
of a soil as has been demonstrated
by&nbsp;.  described
these functions and presented some representative values for the soil
hydraulic parameters needed. They are shown in Table&nbsp;.

<p>

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
<font face=symbol>y</font
> =  <font face=symbol>y</font
><sub>s</sub> </td><td align=left><font face=symbol>
æ<br>ç<br>
è
</font></td><td align=center>
</td><td nowrap align=center>
<font face=symbol>q</font
><hr NOSHADE>
 <font face=symbol>q</font
><sub>s</sub><Br></td><td nowrap align=center>
</td><td align=left><font face=symbol>
ö<br>÷<br>
ø
</font></td><td align=center>
<font size="-1">-b</font> <Br><br>
<font size="-1"></font>&nbsp;<br></td><td nowrap>
</td></Table>
</td><td width=100 align=right>(3.20)</td></table></centEr>



<p>
Soil hydraulic conductivity functions are derived by integrating a
function of <font face=symbol>y</font
> with respect to <font face=symbol>q</font
>. This results in the
following equation:

<centEr><table border=0 align=center><tr><td>
<Table align=left><tr><td nowrap align=center>
</td><td nowrap align=center>
K<hr NOSHADE>
 K<sub>s</sub><Br></td><td nowrap align=center>
 = </td><td align=left><font face=symbol>
æ<br>ç<br>
è
</font></td><td align=center>
</td><td nowrap align=center>
<font face=symbol>q</font
><hr NOSHADE>
 <font face=symbol>q</font
><sub>s</sub><Br></td><td nowrap align=center>
</td><td align=left><font face=symbol>
ö<br>÷<br>
ø
</font></td><td align=center>
<font size="-1">2b + 2</font> <Br><br>
<font size="-1"></font>&nbsp;<br></td><td nowrap>
</td></Table>
</td><td width=100 align=right>(3.21)</td></table></centEr>



<p>
Where:<br>

<table>
<tr><td><font face=symbol>y</font
>	</td><td>suction head </td>
<tr><td><font face=symbol>y</font
><sub>s</sub>	</td><td>suction head at saturation (air entry value) </td>
<tr><td><font face=symbol>q</font
>	</td><td>volumetric water content </td>
<tr><td><font face=symbol>q</font
><sub>s</sub>	</td><td>water content at saturation (porosity)</td>
<tr><td>b	</td><td>soil characteristic parameter</td>
<tr><td>K	</td><td>hydraulic cnductivity </td>
<tr><td>K<sub>s</sub>	</td><td>saturated hydraulic conductivity </td>
<tr><td></td></table>


<p>

<p><A NAME="tth_tAb3.1">
</A> 
<center>
<table><tr><td>
<tr><td>Soil Texture </td><td>[<font face=symbol>`</font
>b] </td><td>[<font face=symbol>`</font
>(<font face=symbol>y</font
><sub>s</sub>)] </td><td>[<font face=symbol>`</font
>(<font face=symbol>q</font
><sub>s</sub>)] </td><td>[<font face=symbol>`</font
>(K<sub>s</sub>)] </td>
<tr><td>Sand </td><td>4.05 </td><td>12.2 </td><td>0.395 </td><td>1520.64 </td>
<tr><td>Loamy sand </td><td>4.38 </td><td>9.0 </td><td>0.410 </td><td>1350.72 </td>
<tr><td>Sandy loam </td><td>4.90 </td><td>21.8 </td><td>0.435 </td><td>299.52 </td>
<tr><td>Silt loam </td><td>5.3 </td><td>78.6 </td><td>0.485 </td><td>62.21 </td>
<tr><td>Loam </td><td>5.39 </td><td>47.8 </td><td>0.451 </td><td>60.05 </td>
<tr><td>Sandy clay loam </td><td>7.12 </td><td>29.9 </td><td>0.420 </td><td>54.43 </td>
<tr><td>Silty clay loam </td><td>7.75 </td><td>35.6 </td><td>0.477 </td><td>14.69 </td>
<tr><td>Clay loam </td><td>8.52 </td><td>63.0 </td><td>0.476 </td><td>21.17 </td>
<tr><td>Sandy clay </td><td>10.4 </td><td>15.3 </td><td>0.426 </td><td>18.72 </td>
<tr><td>Silty clay </td><td>10.4 </td><td>49.0 </td><td>0.492 </td><td>8.93 </td>
<tr><td>Clay </td><td>11.4 </td><td>40.5 </td><td>0.482 </td><td>11.09 </td><tr><td></td></table>
</center><br>
<A NAME="tab:clapp">
</A>

<p>
 <center>      Table 3.1: Representative values for hydraulic parameters. 
After Clapp (1978).</center>
<p>
<p>
An input file containing all the soil-types mentioned in table&nbsp;<A href="#tab:clapp">3.1</A>
can be found in the src/sllib directory. It is called <tt>soillib.inp</tt><a NAME="soillib.inp34">
</a>.

<p>
      <H3><A NAME="tth_sEc3.4.4">
3.4.4</A>&nbsp;&nbsp;Bottom boundary conditions</H3>
 Vamps&nbsp;can  handle several boundary conditions at the bottom of  the
profile.  Below is a lists of those available in the model. Not all
conditions have been fully tested in the present version of  Vamps.

<p>

<UL> 
<li> A no-flow bottom boundary (5)

<li> Free drainage at the bottom of the profile (6)

<li> A fixed head at the bottom of the profile (4)

<li> A fixed flux at the bottom of the profile (1)

<li> Daily groundwater depth (0)

<li> Seepage or infiltration from/to deep groundwater (2)

<li> Flux calculated as a function of head (3)
</UL>
<p>
The choice of bottom boundary condition is of great importance to
the results of the modelling. Unfortunately
most of the time the choice of bottom boundary is usually determined 
by the available data or lack thereof.

<p>
See <b>vamps</b>(5) for details<a href="#tthFtNtABE" name=tthFrefABE><sup>14</sup></a><a NAME="bottom34">
</a><a NAME="soil34">
</a>.
 
<p>
 <br><H1>Part 2   <br>User's guide</H1><br>

<p>
      <H1><A NAME="tth_chAp4">
Chapter 4     </A><br>Installation of  Vamps</H1>
Because  Vamps&nbsp;runs on several quite different platforms installation
requires some things to be set.  Vamps&nbsp;is distributed as source code
only or as source code plus binaries. As I only have access to MS-DOS,
Linux, Sun-OS and OS/2 systems these are the only binaries I can make.

<p>
In the case of a  unix system installation from source
code the following steps are required:

<OL type="1">
<p>

<li> First read the files <tt>0readme</tt><a NAME="0readme40">
</a> and <tt>0install</tt><a NAME="0install40">
</a>.

<p>

<li> Run the <tt>configure</tt><a NAME="configure40">
</a> script in the <tt>src</tt><a NAME="src40">
</a> directory. If you
don't want to install  Vamps&nbsp;in <tt>/usr/local</tt><a NAME="/usr/local40">
</a> make sure to run
the <tt>configure</tt><a NAME="configure40">
</a> script with the
<tt>-prefix=/your/installdir</tt><a NAME="--prefix=/your/installdir40">
</a> option. If you have the agl or
<b>S-Lang</b>&nbsp;library installed in a non-standard place set the LDFLAGS
environment variable so that <tt>configure</tt><a NAME="configure40">
</a> can find them
(e.g. <tt>setenv LDFLAGS -L/home/schj/lib</tt><a NAME="setenv LDFLAGS -L/home/schj/lib40">
</a>). If you don't have
<b>S-Lang</b>&nbsp;now would be a good time to install it.

<p>

<li> Check the top part of the Makefile in the  src directory

<p>

<li> Run make lib, make all and make install.
</OL>
<p>
In case of an MS-DOS system (it should be a 386Sx at least) it is
sufficient to copy all the .exe files to a directory in your
search-path. You should also copy the default <tt>vamps.rc<a NAME="vamps.rc40">
</a></tt>
and <tt>vamps.sl<a NAME="vamps.sl40">
</a></tt> files - all located in the sllib directory
- to a place where  Vamps&nbsp;can find them (set the <tt>HOME<a NAME="HOME40">
</a></tt>
or <tt>VAMPSLIB</tt> environment variable to the directory in which these
files reside).

<p>
You will need to have the <b>S-Lang</b> library installed if you want to
compile the program from source. The <b>S-Lang</b>&nbsp;library can be found at
<tt>ftp://space.mit.edu/pub/davis/slang</tt>.

<p>
      <H1><A NAME="tth_chAp5">
Chapter 5     </A><br>Program organization</H1>

<p>
        <H2><A NAME="tth_sEc5.1">
5.1</A>&nbsp;&nbsp;Introduction</H2>
The main module of  Vamps&nbsp;is the  Vamps&nbsp;program itself. It uses a
series of equations to describe the flow of water through a forested
ecosystem.  Preparing input for the  Vamps&nbsp;program takes quite a
while and is by no means a trivial task. Some 'basic' understanding of
the functioning of forested ecosystems is needed.

<p>
REWRITE THIS !!!

<p>
To facilitate the data pre- and post-processing some tools are
included: The <b>wrini<a NAME="wrini51">
</a></b>(1) program can be used to create
input files at a basic level.  It is mostly used in scripts. The <b>
issec<a NAME="issec51">
</a></b>(1) and <b>getstr<a NAME="getstr51">
</a></b>(1) programs can be used to
extract part of output files. For general post-processing however, the
<b>vsel<a NAME="vsel51">
</a></b>(1) program is recommend.  This program can produce
data the can be fed directly to plotting programs such as <b>
gnuplot<a NAME="gnuplot51">
</a></b>(1) and <b>graph<a NAME="graph51">
</a></b>(1). <b>vsel</b> output can
also be imported into popular spreadsheet programs.
<a href="#tthFtNtABF" name=tthFrefABF><sup>15</sup></a>

<p>
 Vamps can crash in certain situations. This can have three reasons: <em>
(1)</em> I have made an error, causing you to discover a genuine bug, (2)
the situation you want to model is beyond the capabilities of  Vamps,
<em>(3)</em> the timestep estimate done by  Vamps is not right. The
method that is used to solve Richards equation is rather stable but can
go bezerk given the right combination of boundary conditions and soil
parameters. A lot of precipitation on a <em>very</em> clayey soil is a
recipe for disaster.  There are some options you can use to circumvent
some problems. They are described in section&nbsp;

<p>
        <H2><A NAME="tth_sEc5.2">
5.2</A>&nbsp;&nbsp;System requirements</H2>

<p>
If you are not in a hurry a 386Sx MS-DOS based computer with a 1.44Mb
floppy drive is the minimum you need for running  Vamps. As most
calculations are done with floating point numbers, a 387 co-processor
will speed up things a lot<a href="#tthFtNtABG" name=tthFrefABG><sup>16</sup></a>. Djgpp<a href="#tthFtNtABH" name=tthFrefABH><sup>17</sup></a> compiled programs
require a  dpmi<a NAME="dpmi52">
</a> server<a href="#tthFtNtABI" name=tthFrefABI><sup>18</sup></a> and should run with 512
Kb of memory, although 1Mb should be considered a minimum. You need
some disk space as well. The  Vamps&nbsp;binary does not use a lot of it,
but your input (and certainly output) data will probably by the
biggest users of disk space.  Vamps&nbsp;is known to run with several
operating systems<a NAME="operating systems52">
</a>: MS-DOS, Linux, Net-BSD, Sun-OS, AIX 3.2 and OS/2
Warp. 

<p>
        <H2><A NAME="tth_sEc5.3">
5.3</A>&nbsp;&nbsp;Defaults file</H2>
REWRITE!! Several layers!

<p>
Some settings which you want to use in several sessions can be added
to the  Vamps&nbsp;defaults file. The name of this file is <tt>.vampsrc</tt> on
unix systems or <tt>vamps.rc</tt> or FAT based (MS-DOS or OS/2) systems.
 Vamps&nbsp;first searches for this file in the current directory, if
this fails the directory to which the HOME environment variable is set
is searched.  After this the directory to which the VAMPSLIB
environment variable is set is searched. If this also fails the
compiled-in <tt>vampslib</tt> directory is searched.  If no defaults file
is found compiled-in defaults will be used. The syntax of the defaults
file is the same as the general input file. Allowed sections and
variables are described in section&nbsp; on
page&nbsp;.

<p>
If  Vamps&nbsp;is compiled with <b>S-Lang</b>&nbsp;support it also needs to load
several <b>S-Lang</b>&nbsp;files at startup. These must be present in the
VAMPSLIB directory. If (this is an MS-DOS example) you have installed
 Vamps&nbsp;in c:<tt>\</tt>vamps you should use the following command to let
 Vamps&nbsp;find it's files:

<blockquote>
<p>
<tt>set VAMPSLIB=c:<tt>\</tt>vamps</tt>
</blockquote>
<p>
In  unix the command to set an environment variable differs
per shell used, in the c-shell you could use: 

<blockquote>
<p>
<tt>setenv VAMPSLIB /home/usr-x/lib/vamps</tt>
</blockquote>
<p>
        <H2><A NAME="tth_sEc5.4">
5.4</A>&nbsp;&nbsp;Time series and time steps</H2><A NAME="sec:tstep">
</A>
Time series are values of certain variables over time that  Vamps&nbsp;uses as input. An example of a time series is precipitation.  All time
series <a href="#tthFtNtABJ" name=tthFrefABJ><sup>19</sup></a>  must be listed in the ts section of the input file.

<p>
The precipitation time series is quite special because it <em>must</em> be
present. This is because this time series determines the time steps
that  Vamps&nbsp;make with it's x-column. This column should be in days or
fractions of day (i.e. 1.5 is halfway day 1). Time steps may vary
within one run. The following example of a precipitation input file
shows how this is done:

<pre>
# This is a comment
# Precipitation from the no-name site 
# time in days         amounts in cm/day (intensity!)
0.5		0.6
1.0		0.9
2.0		0.7
2.1		0.9
2.2		0.7
2.3		0.5
3.0		0.8
3.5		0.0
</pre>
In this case 0.9 cm/day fell between day 2.0 and day 2.1 amounting to
 0.9 (2.1 - 2.0 = 0.09) cm.  There are
several things that must be remembered with respect to time-steps and
input-files in  Vamps:

<OL type="1">
<p>

<li> Units are in cm/day. With precipitation you might have to convert
your data to intensities.

<li> The time in the x-column is the <em>end</em> of an interval. In
of the above example output given at time 3.0 is calculated from the
situation at time 2.3 after including the precipitation
from time 3.0.  The duration of this time-step is 0.7 days (3.0 - 2.3). This
implies that in the case of the first record no duration of the time-step is
known.  Vamps&nbsp;defaults to one day for the first time-step. You can change
this using the <tt>firststep</tt><a NAME="firststep54">
</a> variable in the <tt>time</tt><a NAME="time54">
</a> section of the
input file.

<li> At present the x-column in all files but the precipitation-file
is ignored (that is, it must be present, but  Vamps&nbsp;does not check
the time-values).
</OL>
<p>
        <H2><A NAME="tth_sEc5.5">
5.5</A>&nbsp;&nbsp;The principle of layers in the soil section</H2><A NAME="sec:physlay">
</A>
The <tt>layers</tt><a NAME="layers55">
</a> variable in the <tt>soil</tt><a NAME="soil55">
</a> section determines the
number of layers used by  Vamps&nbsp;in the <em>calculations</em>
<a href="#tthFtNtACA" name=tthFrefACA><sup>20</sup></a>. The number of <em>physical</em> layers (with different
K<sub>sat</sub> for example) is determined by the number of <tt>layer_n</tt><a NAME="layer\_n55">
</a>
sections you have. Figure&nbsp; shows this principle.  The
users specifies the first layer of each physical layer. Any layer that
is not specified automatically inherits the settings from the
overlying layer.

<p>

<p><A NAME="tth_fIg5.1">
</A> 
<center><a href="figure=psfig/layers.eps">Figure</a></center><br> <center>      Figure 5.1: Relation between the layers variable in the soil section and
the amount of physical layers.</center>
<A NAME="fig:layers">
</A>
<p>
<p>
      <H1><A NAME="tth_chAp6">
Chapter 6     </A><br>The input file</H1>

<p>
        <H2><A NAME="tth_sEc6.1">
6.1</A>&nbsp;&nbsp;introduction</H2>

<p>
 Vamps&nbsp;reads it's options and  most of the  data needed for  modelling
from the input file. This file is in plain ascii format and is divided in
several sections. The exact format of this file is described in
section&nbsp;.  An input file must be created before
running  Vamps.  There are two way of creating an input file for  Vamps.
<em>(1)</em> Use the (not finished)  Vamps&nbsp;preprocessor. This
preprocessor<a href="#tthFtNtACB" name=tthFrefACB><sup>21</sup></a> will let you choose from menu items to select all the
options that are set in the input file and generate an input file for you
once you are finished. Or you can <em>(2)</em> use an ascii editor or a
word-processing package to create this file.

<p>
        <H2><A NAME="tth_sEc6.2">
6.2</A>&nbsp;&nbsp;Input file format</H2><A NAME="sec:inputfileformat">
</A>
The input file format for  Vamps&nbsp;is much like Microsoft Windows <tt>.ini</tt>
files.  All names and sections are case insensitive.  The case of string
variables is unaltered so filenames are case-sensitive if the operating
system is. The file is divided into sections which each contain variables
that have some connection with each other.  Each variable name is followed
by an equal sign (), after which the value of the variable is placed.
Example:

<p>

<pre>
[vamps] 
verbose = TRUE 
# This is a comment

[environment]
caseid = Interception test file. Bisley catchment.\
Summer of 1995
</pre>

<p>
The  &nbsp;character may be use to break up long strings over more
than one line<a href="#tthFtNtACC" name=tthFrefACC><sup>22</sup></a>. The  # sign at the start of a line is used to denote a comment
Only the first '=' sign is significant. Spaces within the names are
copied verbatim, and thus become part of the name. This makes the
following construction legal:

<pre>
[vamps]
output mode = This is ('=') a nonsense\
example.
</pre>

<p>
In this case the variable 'name' in section 'vamps' is 'output mode'
and it's value is 'This is ('=') a nonsense example'.

<p>
<a href="#tthFtNtACD" name=tthFrefACD><sup>23</sup></a><a NAME="commentchar62">
</a><a NAME="vamps62">
</a>.

<p>
 Vamps&nbsp;uses six types of variables: <em>(1)</em> floats<a NAME="floats62">
</a> (floating point
numbers), <em>(2)</em> arrays<a NAME="arrays62">
</a> (a row of floating point numbers
separated by whitespace), <em>(3)</em> strings<a NAME="strings62">
</a> (a series of
characters), <em>(4)</em> integers<a NAME="integers62">
</a> (whole signed numbers), <em>
(5)</em> characters<a NAME="characters62">
</a> (a single printable character) and <em>(6)</em>
boolean<a NAME="boolean62">
</a> (special kind of integer, either 0 or 1 - FALSE of TRUE, NO or YES).

<p>
        <H2><A NAME="tth_sEc6.3">
6.3</A>&nbsp;&nbsp;Available sections and variables</H2><A NAME="sec:sections">
</A>
All sections with available variables and their defaults values as
well as the type of the variable are listed below.  The most up to
date list is presently found in the <b>vamps(5)</b> manual page.  You
will need this list badly when you construct an input file for
 Vamps\. Once the graphical preprocessor is finished things will
become a little easier.

<p>
 Vamps&nbsp;has been developed using the <b>swap94</b>  Fortran code as a 
starting point.  Most names of variables have been changed (sorry) but
some of the variable names as well  as their physical meaning have not
been altered.

<p>
      <H3><A NAME="tth_sEc6.3.1">
6.3.1</A>&nbsp;&nbsp;[vamps]</H3><A NAME="section:defaults">
</A>

<DL compact>
<p>
<dt><b>verbose</b></dt>
	<dd> If set to FALSE  Vamps&nbsp;will be  silent, if set to
TRUE  Vamps&nbsp;will display progress information

<p>
<dt><b>header</b></dt>
	<dd><a href="#tthFtNtACE" name=tthFrefACE><sup>24</sup></a>
Is set to FALSE  no header in will be added to the output, if
set to TRUE an  header will be added to the output. Defaults is FALSE

<p>
<dt><b>logging</b></dt>
	<dd> FALSE = no logging is done, TRUE = logging is on

<p>
<dt><b>logfilename</b></dt>
	<dd> name of the file to which logging is performed

<p>
<dt><b>iniinmem</b></dt>
	<dd>
TRUE = the input file is read into memory (some speedup), FALSE = the
input file is not read into memory

<p>
<dt><b>progstr</b></dt>
	<dd>
String which is used to display progress information (use 0, 1 or 2
for build in strings).  0 will show calculation time and estimated
time to go. 1 will show a percentage finished bar and 2 will show
'calculating'.

<p>
You can define your own such as:

<blockquote>
<p>
<tt>Vamps is running, please wait......................</tt>
</blockquote>
<p>
<dt><b>graphcommand</b></dt>
	<dd> full path to <tt>gnuplot</tt>
with optional command line options. In OS/2 only gnuplot.exe should be
specified here. This seems to be a 'bug' in the emx library which I used
to make the binaries.

<p>
<dt><b>commentchars</b></dt>
	<dd>
Character(s) that denotes the start of a comment. This defaults to #%
and the first character should <em>not</em> be changed unless you have a
very good reason to do so.

<p>
<dt><b>xtrasl</b></dt>
	<dd>
comma seperated  list of <b>S-Lang</b>&nbsp;files to be loaded a startup
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.2">
6.3.2</A>&nbsp;&nbsp;[time]</H3><A NAME="section:time">
</A>

<p>
 Vamps&nbsp;will not run without a time section in the input file with at
least the <tt>steps</tt><a NAME="steps63">
</a> variable set<a href="#tthFtNtACF" name=tthFrefACF><sup>25</sup></a>.  

<p>

<DL compact><dt><b>steps</b></dt>
	<dd> Integer value specifying the number of steps in the 
current simulation.  This value should be smaller or equal to the
number of entries in the precipitation file.

<p>
<dt><b>startpos</b></dt>
	<dd> Position (line) in the precipitation input file used as
start. Counting starts at zero.

<p>
<dt><b>starttime</b></dt>
	<dd> 
day at which the simulation should start If this value is not
specified simulation starts at the first step in the precipitation
input file.  If both starttime and startpos are specified starttime
will be used.
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.3">
6.3.3</A>&nbsp;&nbsp;[run]</H3>

<DL compact>
<p>
<dt><b>outputfile</b></dt>
	<dd>
Filename to save output to. You can override this with the o command
line option.

<p>
<dt><b>runid</b></dt>
	<dd>
No used at moment
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.4">
6.3.4</A>&nbsp;&nbsp;[xout]</H3><A NAME="section:xout">
</A>

<DL compact>
<p>
<dt><b>filename</b></dt>
	<dd>
Filename for extra output in column type format. No extra output is generated if
this variable is not present.
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.5">
6.3.5</A>&nbsp;&nbsp;[determine]</H3><A NAME="section:determine">
</A>

<p>

<DL compact><dt><b>canopy</b></dt>
	<dd>
determine canopy (see section canopy)

<p>
<dt><b>evaporation</b></dt>
	<dd>
determine actual evaporation (see section evaporation)

<p>
<dt><b>pevaporation</b></dt>
	<dd>
determine potential evaporation (see section pevaporation)

<p>
<dt><b>soilmoisture</b></dt>
	<dd>
determine soilmoisture profile (see section soil)

<p>
<dt><b>fit</b></dt>
	<dd>
Use non-linear regression to try and fit to measured data (see fit section)
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.6">
6.3.6</A>&nbsp;&nbsp;[pevaporation]</H3><A NAME="section:pevaporation">
</A>

<DL compact>
<p>
<dt><b>method</b></dt>
	<dd>
0 = potential evaporation via Penman E0 (Need: refrad, netrad, rhumid,
windspeed, temp, inrad),
1 =  potential evaporation   via  Penman E0 (using   sunratio)  (Need:
sunratio, rhumid, windspeed, temp, inrad),
2 and 3 = not yet done,
4 =  potential evaporation using    Makkink (Need: rhumid,  windspeed,
temp, inrad)
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.7">
6.3.7</A>&nbsp;&nbsp;[evaporation]</H3><A NAME="section:evaporation">
</A>

<DL compact>
<p>
<dt><b>method</b></dt>
	<dd>
0 = evaporation equal to potential evaporation,
1 = multiply potential evaporation by a crop factor (need cropfac),
2 = calculate actual evaporation using the Penman-Montheith formula

<p>
<dt><b>cropfac</b></dt>
	<dd>
A  floating point number  representing the crop  factor with which the
potential evaporation is to be multiplied to yield actual evaporation.
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.8">
6.3.8</A>&nbsp;&nbsp;[interception]</H3><A NAME="section:interception">
</A>

<DL compact>
<p>
<dt><b>method</b></dt>
	<dd>
0, 1 , 2, 3.
gash, rutter laifrac or calder

<p>
<dt><b>gamma</b></dt>
	<dd>
gamma in calder equation

<p>
<dt><b>delta</b></dt>
	<dd>
delta in calder equation

<p>
<dt><b>E_avg/R</b></dt>
	<dd>
Evaporation/Average Rainfall during a storm   in gash. If this is  not
set penman/Montheith will be used with R<sub>a</sub> set to zero.

<p>
<dt><b>p_tr</b></dt>
	<dd>
Fraction of water diverted to the trunk (gash, rutter)

<p>
<dt><b>p_f</b></dt>
	<dd>
Free throughfall coefficient (gash, rutter)

<p>
<dt><b>S</b></dt>
	<dd>
Canopy storage in cm (gash, rutter)

<p>
<dt><b>gashm</b></dt>
	<dd>
Either 1 or 0. If set to 1 an adapted version of gash is used. This
version should work for time-steps smaller then 1 day. Default = 0

<p>
<dt><b>laifrac</b></dt>
	<dd>
the canopy interception coefficient

<p>
<dt><b>lai</b></dt>
	<dd>
The canopy leaf area index. This is needed for the laifrac method. If
it is not present it is searched in the canopy section.
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.9">
6.3.9</A>&nbsp;&nbsp;[canopy]</H3><A NAME="section:canopy">
</A>

<p>
Although you don't have to use the canopy module it is recommend that
you do so if possible. The other methods of determining transpiration,
interception etc. don't have a close interaction with the soil modules
and usually provide poorer results.

<p>

<DL compact><dt><b>layers</b></dt>
	<dd>
Number of canopy layers (this is largely determined by the accuracy of your
LAI profile). At the moment only one layer is allowed.

<p>
<dt><b>Rnet_absorb</b></dt>
	<dd>
The fraction of the total radiation absorbed by the canopy (0 <font face=symbol>£</font
> Rnet_absorb  <font face=symbol>£</font
> 1). The remaining amount will be used for soil
evaporation.

<p>
<dt><b>transpiration</b></dt>
	<dd>
Which transpiration equation should be used.
<br>
<p>
2 = penman Montheith
<dt><b>z</b></dt>
	<dd>
Height of the canopy (m)

<p>
<dt><b>z_0</b></dt>
	<dd>
Aerodynamic roughness length (m)

<p>
<dt><b>d</b></dt>
	<dd>
Zero plane displacement length (m)

<p>
<dt><b>rs</b></dt>
	<dd>
Canopy resistance (s/m). If this is not specified the user defined regression 
equation <b>estrs()</b> will be used.

<p>
<dt><b>drytime</b></dt>
	<dd>
If this variable is set this value (in days) will be used to determine
how long it takes for the canopy to dry. 

<p>
<dt><b>wetevap</b></dt>
	<dd>
If this variable is set this value (in cm/day) will be used to determine
the canopy wat evaporation rate in stead of Penman-Montheith with
Rs set to zero.
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.10">
6.3.10</A>&nbsp;&nbsp;[roots]</H3><A NAME="section:roots">
</A>

<DL compact>
<p>
<dt><b>depth</b></dt>
	<dd>
depth of the root zone in cm. If you want rooting depth to change in
time you should use the <tt>drootz</tt><a NAME="drootz63">
</a> variable in the <tt>ts</tt><a NAME="ts63">
</a>
section.

<p>
<dt><b>swsink</b></dt>
	<dd>
0 = sink term according to Feddes. (Need: hlim1 hlim2u hlim2l hlim3h
hlim3l hlim4)<br>
1 = sink term according to Hoogland. (Need: hlim1
hlim2u hlim2l hlim3 hlim4) 

<p>
<dt><b>swhypr</b></dt>
	<dd> 0 = linear relation between
the points hlim3 and hlim4 of the sink term.<br>
1 = hyperbolic
relation between the points hlim3 and hlim4 of the sink term.

<p>
<dt><b>swupfu</b></dt>
	<dd>
0 = water uptake function according to Feddes.<br>
1 = water uptake function according to Hoogland.<br>
2 = water uptake function according to Prasad (1988).

<p>
<dt><b>cofsza</b></dt>
	<dd> Intercept a in Feddes et. al 1988 (only needed if swupfu =1).

<p>
<dt><b>cofszb</b></dt>
	<dd> Slope b in Feddes et. al. 1988. (only needed if .B swupfu =1).

<p>
<dt><b>hlim1</b></dt>
	<dd> 
Pressure head value (cm) below which roots start to extract water from
the upper soil layer (starting point).

<p>
<dt><b>hlim2u</b></dt>
	<dd>
Pressure head
value (cm) below which roots start to extract water optimally from the
upper soil layer.

<p>
<dt><b>hlim2l</b></dt>
	<dd> 
As above, but for all lower soil layers.

<p>
<dt><b>hlim3h</b></dt>
	<dd>
Pressure head value (cm) below which roots cannot extract water
optimally any more, for a High pot. transpiration rate equal to 0.5
cm/d (limiting point).

<p>
<dt><b>hlim3l</b></dt>
	<dd> 
As above, but for low pot. transpiration rate equal to 0.1 cm/d.

<p>
<dt><b>hlim3</b></dt>
	<dd>
Pressure head value (cm) below which roots cannot extract water any
more (limiting point).

<p>
<dt><b>hlim4</b></dt>
	<dd>
Pressure head value (cm) below which no water uptake by roots is
possible (wilting point).
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.11">
6.3.11</A>&nbsp;&nbsp;[ts]</H3><A NAME="section:ts">
</A>
The ts section has one entry that <em>must</em> be present:
precipitation.  The precipitation file is important because it also
determines the time-steps at which output is calculated. More
information about time-steps can be found in
section&nbsp;<A href="#sec:tstep">5.4</A>. 

<p><A NAME="tth_fIg6.1">
</A> 
<p>
<a href="figure=psfig/soilr.eps">Figure</a><p>The file format consists of colums separeted by whitespace (space
or tabs).   Vamps&nbsp;assumes the first column to hold the time and the
second column to hold the value. You can override these assumptions by
appending <tt>,xcol,ycol</tt> to the filename<a href="#tthFtNtACG" name=tthFrefACG><sup>26</sup></a>. Counting begins at zero.

<p>
The ts section can be handy if you don't like the method(s) which
 Vamps&nbsp;can use for determining things like potential evaporation.
Simply put them in here and  Vamps&nbsp;will use the values you supplied
instead.

<p>

<DL compact><dt><b>pevaporation</b></dt>
	<dd>
Name of file with potential evaporation data (if not calculated)

<p>
<dt><b>ptranspiration</b></dt>
	<dd>
Name of file with potential transpiration data (if not calculated)

<p>
<dt><b>interception</b></dt>
	<dd>
Name of the file with interception data (if not calculated)

<p>
<dt><b>precipitation</b></dt>
	<dd>
Name of file with precipitation data. This file file also determines
the time-steps at which output is calculated. See section&nbsp;<A href="#sec:tstep">5.4</A>
for more information.

<p>
<dt><b>drootz</b></dt>
	<dd>
Name of file with rooting depth (cm) in time. You need to specify at
least three points. Other points will be interpolated using a spline
if they don't exist. See the file <tt>src/tc/ts_spl.c</tt> for the
interpolation routine.
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.12">
6.3.12</A>&nbsp;&nbsp;[soil]</H3><A NAME="section:soil">
</A>

<DL compact>
<p>
<dt><b>outskip</b></dt>
	<dd>
Skip outskip timesteps in soil output. Used to reduce
outputfile size.

<p>
<dt><b>initprof</b></dt>
	<dd>
0 = water content profile (need theta_initial array),
1 = pressure head profile (need h_initial array) and
2 = Calculate pressure head profile (need gw_initial in soil section).

<p>
<dt><b>gw_initial</b></dt>
	<dd>
initial ground-water level in cm below field-level (needed if 
initprof = 2)

<p>
<dt><b>swredu</b></dt>
	<dd>
Reduction of soil evaporation <br>
0 = no reduction, 1 = the Black (1969) model is used,
2 = the Boesten (1986) model is used and
3 = an adapted version of the Boesten (1986) model is used. 
This version takes into
account the actual moisture condition of the soil surface.

<p>
<dt><b>cofred</b></dt>
	<dd>
The factor alfa in Black or Beta in Boesten. This is not needed for
swredu = 0.  
<dt><b>bottom</b></dt>
	<dd>
Bottom boundary condition:
0 = daily ground-water table depth (cm) is input,
1 = Given flux,
2 = seepage or infiltration from/to deep ground-water,
3 = Flux calculated as a function of h,
4 = interpolation between daily values of given pressure head,
5 = Zero flux at bottom,
6 = Free drainage.

<p>
<dt><b>smooth</b></dt>
	<dd>
Integer value giving the size of the running average used for smoothing 
the ksat, theta_saturation and residual_water profile. 
Set to zero for no smoothing (default).

<p>
<dt><b>layers</b></dt>
	<dd>]
Number of soil layers in calculation (how many real (physical) layers
exist is specified by the amount of layers_<em>n</em> sections<a href="#tthFtNtACH" name=tthFrefACH><sup>27</sup></a>)

<p>
<dt><b>pondmx</b></dt>
	<dd>
Maximum amount of ponding (in cm) allowed at the top of the profile,
defaults to 0.0.

<p>
<dt><b>gwlevel</b></dt>
	<dd>
Water level at bottom of profile, needed
if bottom = 4 

<p>
<dt><b>dtmax</b></dt>
	<dd>
Maximum time-step (in days) in soil module

<p>
<dt><b>dtmin</b></dt>
	<dd>
Minimum time-step (in days) in soil module. Both dtmax and dtmin
should probably be left alone. By setting dtmin and dtmax to the 
same value  Vamps&nbsp;can be forced to use a fixed time-step.

<p>
<dt><b>speed</b></dt>
	<dd>
Integer value ranging from 1 (slow) to 6 (fastest) determining
the tradeoff between calculation accuracy and speed. This options
combines the settings in dtmin, thetol, solvemet, mktable,
maxitr and swnums.

<p>
If you also specify one of these variables seperately the settings
from speed are overridden. Default  for speed is 3.

<p>
<dt><b>maxitr</b></dt>
	<dd>
Maximum number of iterations in the soil module. Iterations
are only performed if swnums == 1.

<p>
<dt><b>thetol</b></dt>
	<dd>
Theta tolerance. If swnums != 1 (by default) 
 Vamps&nbsp;will use this value to check if the solution is good enough and
perform iterations if needed. Setting this value to high or low
gives poor results. The default value usually works fine. If
you have no problems you better leave this one alone. Usually
this variable should be between 1.0E-2 and 1.0E-5.

<p>
<dt><b>solvemet</b></dt>
	<dd>
Determines how vamps solves the equation matrix.
If set to 0 the default (tridiagonal) solution is used.
If set to 1 the soil module will always treat the solution as a band-diagonal
matrix. If set to 2 a very general solution is used. This solution
includes a step to regain full machine precision but is rather slow.

<p>
<dt><b>swnums</b></dt>
	<dd>
If set to 1 the soil module won't check for convergence of solution.
It assumes that the initial maximum dt is a good guess. Things can be
quit a lot faster in all cases but can give poor results in most cases
as well.

<p>
<dt><b>mktable</b></dt>
	<dd>
if set to true 
 Vamps&nbsp;will create look up tables for the theta vs K relation, and use those
in stead of the function during iteration.  By default this option is
set to false. Set to true to speed up calculation. The solution can
become instable at high suction heads. In stead of letting 
 Vamps&nbsp;generate the look-up tables you can also read pre-made tables
using the method option in the layer_n section.

<p>
Depending on the problem, the amount of memory you have installed, the
floating-point performance of you CPU and the optimizations your
compiler can make, this can speed up calculations by 50%. You will
lose some precision in the process. By default the program uses 300
points long look-up tables. Use the <tt>tablesize</tt><a NAME="tablesize63">
</a> variable in the
<tt>soil</tt><a NAME="soil63">
</a> section to change this value.

<p>
There is no exact way to determine the speed increase you will
get. For example, on a 66MHz 486DX2 running Linux, a 25% speed
increase was established without compiler optimization (gcc) while a
50% speed increase was measured when de program was compiled with
optimization. It seems that gcc does a better job optimizing the look
up procedure than the intensive floating point calculations in the van
Genuchten equation<a href="#tthFtNtACI" name=tthFrefACI><sup>28</sup></a>. 
On a RISC processor with better floating point
performance this balance may be different, and you probably won't get
speed increases of 50%. On a rs6000 365 running AIX 3.2 the mktables
option resulted in a 23% speed increase.

<p>
<dt><b>estdmc</b></dt>
	<dd>
if set to true and the <tt>mktable</tt><a NAME="mktable63">
</a> variable is also true the dmc
table will be made using ts_slopes and the Pf curve in stead of the
<tt>h2dmc</tt><a NAME="h2dmc63">
</a> function. If you use <b>S-Lang</b>&nbsp;soil functions and you define
<tt>estdmc</tt><a NAME="estdmc63">
</a> to be true you don't need the <tt>h2dmc</tt><a NAME="h2dmc63">
</a> function.

<p>
<dt><b>tablesize</b></dt>
	<dd>
Sets the size of the look-up tables. Defaults to 300. Increase this
for better accuracy at a penalty of using more memory and some
performance loss. Provided the program fits in physical memory table
sizes up to 1200 (very large) points still give some speed
improvements compared to not using the look-up tables.  Sometimes
decreasing this to 80 or so can be done without much loss of accuracy
or stability.

<p>
<dt><b>dumptables</b></dt>
	<dd>
If set to true the look up tables will be dumped to the initial
section of the output-file; x and y in separate array type  variables for each
layer. This can be handy for plotting pF curves for example.

<p>
<dt><b>verbose</b></dt>
	<dd>
Verbose level in soil module (0 = silent). I recommend a setting
of 1 (default) which will show you how long  Vamps&nbsp;will run.

<p>
<dt><b>smddepth</b></dt>
	<dd>
If this variable is set the SMD (soil moisture deficit) will
be calculated until this depth. Otherwise the rooting depth
will be taken.
<dt><b>fieldcap</b></dt>
	<dd>
Head in cm at which the soil is at field capacity. Needed for
determination of soil moisture deficit. Default = -100.0

<p>
</DL>      <H3><A NAME="tth_sEc6.3.13">
6.3.13</A>&nbsp;&nbsp;[drainage]</H3><A NAME="section:drainage">
</A>
This is presently in a very experimental stage. One day when  Vamps&nbsp;will be two-dimensional this will become more important.

<p>

<DL compact><dt><b>method</b></dt>
	<dd>
Variable which controls the type of lateral drainage.<br>

<center>
<p>

<table>
<tr><td>Value </td><td>Description </td>
<tr><td>0 </td><td>No lateral drainage (default) </td>
<tr><td>1 </td><td>TOPOG type drainage (only at saturation) and </td>
<tr><td>2 </td><td>Allow also unsaturated lateral flow </td></td></table>
</center><br>
If the <tt>drainage</tt><a NAME="drainage63">
</a> variable is larger than zero the
<tt>slope</tt><a NAME="slope63">
</a> variable must be set also.

<p>
<dt><b>slope</b></dt>
	<dd>
Slope used in the calculation of lateral drainage (floating point value).
 
<p>
<dt><b>exclude</b></dt>
	<dd>
Array with layers in which lateral drainage is not allowed. 
0 &lt;= value &lt; layers  
example:

<pre>
exclude = 12 1 23 45
</pre>
You can use a construction like this and a no-flow bottom boundary
to simulate a lysimeter.

<p>
</DL>      <H3><A NAME="tth_sEc6.3.14">
6.3.14</A>&nbsp;&nbsp;[<em>soilsectionname</em>]</H3><A NAME="section:soilsectionname">
</A>
This section can have <em>any</em> name and contains the soil specific
info.  The <tt>soilsection</tt><a NAME="soilsection63">
</a> variable in the <tt>layer_n</tt><a NAME="layer\_n63">
</a>
section refers to the name of this section.

<p>

<DL compact><dt><b>method</b></dt>
	<dd>

<p>
Method for k vs theta relation:<br>

<center>
<p>

<table>
<tr><td>Value </td><td>Description </td>
<tr><td>0 </td><td>clapp/hornberger</td>
<tr><td>1 </td><td>van Genuchten</td>
<tr><td>2 </td><td>not yet implemented</td>
<tr><td>3 </td><td>van Genuchten parameters are determined from theta vs pf
pairs</td>
<tr><td>4 </td><td>read TOPOG _soil soil tables</td>
<tr><td>5 </td><td>user defined S-Lang functions</td></td></table>
 
</center><br>
<p>

<DL compact><dt><b>ad 3)</b></dt>
	<dd> Given values of alpha and n are used as initial
guesses. Required variables: <tt>theta</tt><a NAME="theta63">
</a> (array of values) and
<tt>pf</tt><a NAME="pf63">
</a> (array of values). Optional: <tt>alpha</tt><a NAME="alpha63">
</a> and <tt>n</tt><a NAME="n63">
</a>.  
The exponent l is set to 0.5,

<p>
<dt><b>ad 4)</b></dt>
	<dd>  Vamps&nbsp;has the ability to read
and use soil tables generated by the TOPOG _soil program. It will
then use these look-up tables in stead of using direct
calculations. In future  Vamps&nbsp;will be distributed with it's own
version of the _soil program

<p>
<dt><b>ad 5)</b></dt>
	<dd>
In this case the user must define the following S-Lang functions:

<p>
 
<center>
<table><tr><td>
<tr><td>Function </td><td>Description </td>
<tr><td><tt>Void getspar(char *section, Int nr)</tt> </td><td>called to get additional parameters from the input file </td>
<tr><td><tt>Float h2dmc(Int nr, Float head)</tt> </td><td>calculates suction head to differential moisture capacity </td>
<tr><td><tt>Float t2k(Int nr, Float theta)</tt> </td><td>calculates k<sub>unsat</sub> from moisture content (theta) </td>
<tr><td><tt>Float t2h(Int nr, Float theta, Float depth)</tt> </td><td>calculates suction head from  moisture content (theta) </td>
<tr><td><tt>Float h2t(Int nr, Float head)</tt> </td><td>calculates moisture content from suction head </td></td></table>

</center><br> 
<p>
If you use this option you should either have a <em>very</em> fast computer or
use the <tt>mktable</tt><a NAME="mktable63">
</a> option in the <tt>soil</tt><a NAME="soil63">
</a> section. The following
tables list some example excecution time when using the some method coded
in C and <b>S-Lang</b>.

<p>
 
<center>
<table><tr><td>
<tr><td>Method </td><td>time [sec] </td>
<tr><td>C - no tables </td><td>25.37 </td>
<tr><td>C - tables </td><td>18.52 </td>
<tr><td>SL - no tables </td><td>393.90 </td>
<tr><td>SL - tables </td><td>19.49 </td></td></table>

</center><br> 
<p>
An example can be found in the file func.sl in the vampslib directory.
</DL>
<p>
<dt><b>description</b></dt>
	<dd>
An optional description of the soil layer.

<p>
<dt><b>ksat</b></dt>
	<dd>
Saturated hydraulic conductivity of the layer.

<p>
<dt><b>kh/kv</b></dt>
	<dd>
Ratio of K<sub>sat</sub> horizontal divided by K<sub>sat</sub> vertical. This
is only used if you use lateral drainage (see drainage section).
By default this is set to one.

<p>
<dt><b>thetas</b></dt>
	<dd>
Theta at saturation (porosity).

<p>
<dt><b>psisat</b></dt>
	<dd>
Head at saturation (air entry value) needed for Clapp/Hornberger

<p>
<dt><b>b</b></dt>
	<dd>
Factor b in Clapp/Hornberger

<p>
<dt><b>theta_residual</b></dt>
	<dd>
Residual amount of soil moisture.

<p>
<dt><b>alpha</b></dt>
	<dd>
Alpha in van Genuchten.

<p>
<dt><b>l</b></dt>
	<dd>
l in van Genuchten (use 0.5 if not determined). Normally (unless you
have determined a theta vs K<sub>unsat</sub> relation) you don't
have this information.

<p>
<dt><b>n</b></dt>
	<dd>
n in van Genuchten.

<p>
<dt><b>tablefile</b></dt>
	<dd>
File from which the soil table should be read. Use this if method = 4.

<p>
<dt><b>tablefiletype</b></dt>
	<dd>
Type of the table-file. All filetypes can have comment-lines starting with #.
<br>
<p>

<center>
<table>
<tr><td>Value </td><td>Description </td>
<tr><td>1 </td><td>TOPOG-type  Vamps&nbsp;only uses columns 1, 3 4 and 5</td>
<tr><td>2 </td><td>White space separated columns (psi theta k)</td>
<tr><td>3 </td><td>White space separated columns (psi theta k diff_moist) </td></td></table>

</center><br>
<p>
ad 2) In this case the differential
moisture capacity (d_theta/d_phi) is estimated.

<p>
Note that all tables should be made with <em>descending</em>
theta values.
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.15">
6.3.15</A>&nbsp;&nbsp;[layer_<em>n</em>]</H3><A NAME="section:layers">
</A>
Only the <tt>layer_0</tt><a NAME="layer\_063">
</a> section is a must. The rest is only needed if you
have more than one physical soil layer.

<p>

<DL compact><dt><b>thickness</b></dt>
	<dd>
Thickness of the layer (in cm).

<p>
<dt><b>soilsection</b></dt>
	<dd>
Name of the section that contains the soiltype info for this layer (node).

<p>
</DL>      <H3><A NAME="tth_sEc6.3.16">
6.3.16</A>&nbsp;&nbsp;[fit]</H3><A NAME="section:fit">
</A>

<DL compact>
<p>
<dt><b>fit</b></dt>
	<dd>
Data-set used in fitting

<p>
<dt><b>fitto</b></dt>
	<dd>
Name of a time serie (must be specified in the ts section) with
actual measurements

<p>
<dt><b>n</b></dt>
	<dd>
(n = 0 ... n= MAXPAR)
Add a new parameter to the fitting list.
At present the following
parameters are available:
<br>
<p>
1 (n)
<br>
<p>
2 (alpha)
<br>
<p>
3 (ksat)
<br>
<p>
4 (b)
<br>
<p>
5 (psisat)
<br>
<p>
6 (l)
<br>
<p>
7 (residual_water)
<br>
<p>
8 (thetas)

<p>
<dt><b>layer</b></dt>
	<dd>
Physical layer to use in fitting.
</DL>
<p>
      <H3><A NAME="tth_sEc6.3.17">
6.3.17</A>&nbsp;&nbsp;Valid datasets</H3>
 Vamps&nbsp;recognizes the following datasets:<a href="#tthFtNtACJ" name=tthFrefACJ><sup>29</sup></a>

<UL>
<p>

<li> precipitation [cm]

<li> relative humidity [
<li> head at bottom [cm] 

<li> rooting depth [cm] 

<li> dry bulb temp [oC] 

<li> ground-water table [cm] 

<li> interception [cm] 

<li> troughfall   [cm] 

<li> stemflow     [cm] 

<li> potential evaporation [cm] 

<li> potential soil evaporation [cm] 

<li> potential transpiration [cm] 

<li> flow through bottom of profile [cm] 

<li> actual water content [cm] 

<li> average theta in profile 

<li> leaf area index 

<li> canopy storage [cm???] 

<li> incoming radiation [W/m2] 

<li> net radiation [W/m2] 

<li> reflected radiation [W/m2] 

<li> windspeed [m/s] 

<li> sunratio [n/N] 
</UL>
<p>
        <H2><A NAME="tth_sEc6.4">
6.4</A>&nbsp;&nbsp;Interception</H2>
 Vamps&nbsp;can determine interception loss via several methods. The
Calder method [], the Gash analytical method (see
paragraph&nbsp;<A href="#par:gash">3.3.1</A>) and Rutter's
[] numerical method. For the Rutter method you will need
precipitation data with hourly or shorter intervals.  All parameters
needed for interception calculation are set in the interception section
of the input file. Each method has it's own set of required and optional
arguments. In addition you also need at least one time-series
(precipitation). Figure&nbsp; and Figure&nbsp;
show a part of a input file which calculates interception using the Gash
and the Calder method respectively. A description of all allowed variables
in the interception section is given in section&nbsp;<A href="#sec:sections">6.3</A> on
page&nbsp;<A href="#section:interception">pageref</A>.

<p>
      <H1><A NAME="tth_chAp7">
Chapter 7     </A><br>Running  Vamps</H1>
Although you don't have to use the canopy module it is recommend that
you do so if possible. The other methods of determining transpiration,
interception etc. don't have a close interaction with the soil modules
and usually provide poorer results.

<p>
        <H2><A NAME="tth_sEc7.1">
7.1</A>&nbsp;&nbsp;Command line options</H2>
Options may be given as either standard one-letter options, or GNU style
long options. Long options start with two dashes '' and may be truncated
to any unambiguous abbreviation.

<p>

<DL compact><dt><b>-&nbsp;-Header</b></dt>
	<dd>
Omit the headers in output.

<p>
<dt><b>-&nbsp;-copyright</b></dt>
	<dd>
Show copyright information and exit

<p>
<dt><b>-&nbsp;-license</b></dt>
	<dd>
Print license information and exit.

<p>
<dt><b>-&nbsp;-help</b></dt>
	<dd>
Print help text and exit.

<p>
<dt><b>-&nbsp;-verbose</b></dt>
	<dd>
Enter verbose mode, program progress is displayed on stderr.
Default is silent.

<p>
<dt><b>-&nbsp;-noinputdump</b></dt>
	<dd>
By default the contents of the inputfile is also included in the 
output. Use this option to alter this behaviour.

<p>
<dt><b>-&nbsp;-Output  <em>setname</em></b></dt>
	<dd>
Dump the specified 
<em>setname</em>
to a seperate file in
<b>ts</b>(5)
format. See
<b>vamps</b>(5)
for a list of allowed setnames.

<p>
<dt><b>-&nbsp;-Determine <em>variable</em></b></dt>
	<dd>
Determine variable (can be a single variable or a time series).
See <b>vamps</b>(5)
for a list of allowed variables.

<p>
<dt><b>-&nbsp;-Logfile <em>filename</em></b></dt>
	<dd>
Log this session to the file <em>filename</em>.

<p>
<dt><b>-&nbsp;-Setvar <em>section name value</em></b></dt>
	<dd>
Set the value of variable <em>name</em>
in section <em>section</em> to value <em>value</em>.
This overrides the setting in the input file.

<p>
<dt><b>-&nbsp;-Comment <em>commentchar</em></b></dt>
	<dd>
Set the commentchar to char <em>commentchar</em>.

<p>
<dt><b>-&nbsp;-showdef</b></dt>
	<dd>
Send program defaults to stdout. This can be used to create a
default file from scratch.

<p>
<dt><b>-&nbsp;-output <em>filename</em></b></dt>
	<dd>
Send output to <em>filename</em>
in stead of stdout.

<p>
<dt><b>filename</b></dt>
	<dd>
Read input from <em>filename</em>
</DL>
<p>
        <H2><A NAME="tth_sEc7.2">
7.2</A>&nbsp;&nbsp;Manipulation of time series</H2>
Links to the ts*(1) stuff

<p>
        <H2><A NAME="tth_sEc7.3">
7.3</A>&nbsp;&nbsp;graphically displaying  Vamps&nbsp;results</H2>
Links to the graph(1) stuff

<p>
        <H2><A NAME="tth_sEc7.4">
7.4</A>&nbsp;&nbsp;Troubles..</H2><A NAME="sec:troubles">
</A>
OK, you have problems running  Vamps. You are not alone!
I will describe some problems that you can encounter
using  Vamps. Some have an easy solution, others not.

<p>
      <H3><A NAME="tth_sEc7.4.1">
7.4.1</A>&nbsp;&nbsp;Variable missing</H3>
If  Vamps&nbsp;issues a message like:

<p>

<pre>
deffile.c: Fatal:	could not find	-&#62;steps&lt;-
	in section		-&#62;time&lt;-
	in file			-&#62;example1.inp&lt;-
deffile.c:	error message:
	from: $Id: deffile.c,v 1.23 1996/03/18 09:24:50 schj Exp $
	description: Var not found or invalid, see above.
</pre>

<p>
you have not specified a variable in the input file which  Vamps&nbsp;<em>
needs</em> to run properly. This can be a variable which is needed always
or one that is needed is you have specified so in an other variable.
For example, if you specify the Gash method for determining interception
you <em>must</em> also specify the variable <tt>S</tt><a NAME="S74">
</a> in the <tt>interception</tt><a NAME="interception74">
</a>
section.

<p>
      <H3><A NAME="tth_sEc7.4.2">
7.4.2</A>&nbsp;&nbsp;Mass-balance error warning</H3>

<p>
 Vamps&nbsp;issues a warning when large jumps in the mass-balance error
are encountered. You can ignore them providing you keep in mind that
the solution is not very optimal. At present the mass-balance is <em>
not</em> calculated properly is you use lateral drainage, beware! In most
circumstances decreasing the <tt>dtmax</tt><a NAME="dtmax74">
</a> variable helps, it 
prevents  Vamps&nbsp;from making mistakes in estimating the max timestep.
Descreasing the <tt>dtmin</tt><a NAME="dtmin74">
</a> and/or the <tt>thetol</tt><a NAME="thetol74">
</a> variable should
be next on your list followed by increasing the <tt>maxitr</tt><a NAME="maxitr74">
</a> variable.

<p>
      <H1><A NAME="tth_chAp8">
Chapter 8     </A><br>Using <b>S-Lang</b> with  Vamps</H1>

<p>
        <H2><A NAME="tth_sEc8.1">
8.1</A>&nbsp;&nbsp;Introduction</H2>
To allow users to change functions that  Vamps&nbsp;uses to determine
like converting incoming radiation to net radiation as well as other
emperical equations,  Vamps includes the <b>S-Lang</b> stack based
interpreter.  describes <b>S-Lang</b> as:

<blockquote>
<p>
<b>S-Lang</b> (pronounced ``sssslang'') is a powerful stack based interpreter
   that supports a C-like syntax.  It has been designed from the beginning
   to be easily embedded into a program to make it extensible. <b>S-Lang</b> also
   provides a way to quickly develop and debug the application embedding it
   in a safe and efficient manner.  Since <b>S-Lang</b> resembles C, it is easy to
   recode <b>S-Lang</b> procedures in C if the need arises.
</blockquote>
<p>
The actual syntax of <b>S-Lang</b> is not described here - see
[,] for that - but the way  Vamps uses
<b>S-Lang</b> for it's extensions. Also  Vamps specific <b>S-Lang</b> functions
and variables are described here.

<p>
        <H2><A NAME="tth_sEc8.2">
8.2</A>&nbsp;&nbsp;How  Vamps interfaces with <b>S-Lang</b></H2>

<p>
For speed reasons  Vamps&nbsp;only uses the <b>S-Lang</b> interpreter at
specific locations in the program:

<p>

<OL type="1">
<li> at startup  Vamps&nbsp;loads a file (usually <tt>vamps.sl</tt>) with
the function definitions of functions that  Vamps&nbsp;uses.

<li> at the start of the program - after the input file is read -  Vamps&nbsp;executes the <tt>at_start</tt> function

<li> after each timestep the <tt>each_step</tt> is executed

<li> after all calculations are done - but before data is flushed
from memory - the <tt>at_end</tt> function is executed

<li> a series of regression equations and relations between variables
can be programmed in <b>S-Lang</b>.  Vamps&nbsp;checks is a certain <b>S-Lang</b> function
exits and executes that in stead of the build in function. at present the
following functions can be programmed in <b>S-Lang</b>:

<UL>
<p>

<li> <tt>lai_to_s (lai)</tt> - returns s (canopy storage) for a given lai (leaf area
index)

<li> ......
</UL>
<p>
</OL>      <H1><A NAME="tth_chAp9">
Chapter 9     </A><br> Vamps&nbsp;specific functions and variables</H1>

        <H2><A NAME="tth_sEc9.1">
9.1</A>&nbsp;&nbsp;Intrinsic functions (programmed in C)</H2>

<p>

<b><a NAME="\#91">
</a>#&nbsp;&nbsp;</b>

<pre>
# [plotcommand]
</pre>
Operator to send a single command to the plotting system (gnuplot) when
followed by an argument or to enter plotting mode if no argument is given.
In plotting mode all commands should be gnuplot commands. To switch back to
normal mode give a single '#'. The <tt>:</tt> and <tt>\</tt>@ operators also work within
plotting mode.

<p>
Some special characters can be used to addres S-Lang variables from within
plotting mode. Words withing $'s are replaced by a string representation of
the S-Lang variable with that name. Example

<pre>
variable h = "sin(x)";
# plot $h$
</pre>
To plot S-Lang matrix variables the <tt>\</tt>@ char must be used. Example

<pre>
variable m = mread("mydata.file",-1);
# plot @m@ using 1:2
</pre>
Although S-Lang matrix variables are zero based gnuplot starts counting at
1.

<p>
Variables from vamps output files can also be plotted. In this case both
the name of the of the variable and the output filename are needed.
They should be seperated by a colon and enclosed in <tt>\</tt>@ characters:

<pre>
# plot @precipitation:example1.out@ using boxes
</pre>
See also <tt>plt</tt>.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME=":91">
</a>:&nbsp;&nbsp;</b>

<pre>
: command [options ...]
</pre>
Execute a system <tt>command</tt> in a subshell. Note that the
syntax does not use S-Lang conventions; everything after
the `<tt>:</tt>' is passed to the shell. Returns nothing, a message
is printed on standard error if <tt>command</tt> returned a non-zero
exit status.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="?91">
</a>?&nbsp;&nbsp;</b>

<pre>
? [name ...]
</pre>
Invoke the <tt>vamps</tt> online help system. This command can
only be used when running interactive.

<p>
If a single `<tt>?</tt>' is entered at the prompt, a list of
<tt>names</tt>, typically <tt>vamps</tt> command or variable names, for
which online documentation is present will be printed on
the screen.

<p>
If one or more <tt>name</tt>(s) are given after the `<tt>?</tt>', the
available documentation text for those <tt>name</tt>(s) is printed
on the screen.

<p>
If there is more than one screenfull of text, the <tt>cursor</tt>
and <tt>PgDn/PgUp</tt> keys will cause the text to scroll; pressing
`<tt>q</tt>' will stop text display and go back to the command
prompt.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="91">
</a>@&nbsp;&nbsp;</b>

<pre>
@scriptname
</pre>
This operator passes it's argument to <tt>evalfile</tt>. It
can only be used when running interactively. It
can be used to run scripts in stead of an expression
like:

<pre>
() = evalfile("scriptname");
</pre>
Note the lack of a space between the operator and it's
argument!

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="SLang\_init\_tty91">
</a>SLang_init_tty&nbsp;&nbsp;</b>

<pre>
Int SLang_init_tty()
</pre>
Initialize the S-Lang tty. 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="SLang\_reset\_tty91">
</a>SLang_reset_tty&nbsp;&nbsp;</b>

<pre>
Int SLang_reset_tty()
</pre>
Resets the S-Lang tty. Needed is you want to use stdin and
stdout from interactive mode.  

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="Slai\_to\_s91">
</a>Slai_to_s&nbsp;&nbsp;</b>

<pre>
Float Slai_to_s(Float lai)
</pre>
Function called in the canopy module to convert lai to
canopy storage. If this S-Lang function is not defined the
lai value from the <tt>canopy</tt> section in the input file is used.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="\_sets\_91">
</a>_sets_&nbsp;&nbsp;</b>

<pre>
Int _sets_
</pre>
Number of data sets in memory 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="\_version\_91">
</a>_version_&nbsp;&nbsp;</b>

<pre>
Int _version_
</pre>
Devide by 10 to get version number of Vamps 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="addset91">
</a>addset&nbsp;&nbsp;</b>

<pre>
Void addset(name, points)
</pre>
Adds an empty set <tt>name</tt> with <tt>points</tt> points
to the list

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="addtohist91">
</a>addtohist&nbsp;&nbsp;</b>

<pre>
Int addtohist(string)
</pre>
Adds <tt>string</tt> to the history list.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="arg091">
</a>arg0&nbsp;&nbsp;</b>

<pre>
String arg0
</pre>
Readonly variable holding the name of the application
(``<tt>slash</tt>'' if running interactive) or the name of the
current script file being processed.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="closedef91">
</a>closedef&nbsp;&nbsp;</b>

<pre>
int closedef ()
</pre>
Description: closes a file previously opened with opendef
Returns: fclose's result

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="cont91">
</a>cont&nbsp;&nbsp;</b>

<pre>
cont()
</pre>
Continiue the current Vamps run 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="copyright91">
</a>copyright&nbsp;&nbsp;</b>

<pre>
Void disclaim
Void copyright
</pre>
Shows a short version of the GPL 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="cpu91">
</a>cpu&nbsp;&nbsp;</b>

<pre>
Float cpu()
</pre>
Return the number of CPU seconds used since the start of
the program. On msdos systems this will be equal to the
total run-time. On multitasking systems the actually used cpu time
will be returned.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="defverb91">
</a>defverb&nbsp;&nbsp;</b>

<pre>
Int defverb
</pre>
The verbose level in the input file routines. 0 is quit. A higher
the number makes this part of Vamps more verbose 

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="disclaim91">
</a>disclaim&nbsp;&nbsp;</b>

<pre>
Void disclaim
Void copyright
</pre>
Shows a short version of the GPL 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="error91">
</a>error&nbsp;&nbsp;</b>

<pre>
Void error(String str)
</pre>
Prints the text held in <tt>str</tt> followed by a newline on standard
error output and raises internal error status.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="exit91">
</a>exit&nbsp;&nbsp;</b>

<pre>
exit()
quit()
</pre>
Quits the S-Lang interpreter and returns to the
operating system 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="exit91">
</a>exit&nbsp;&nbsp;</b>

<pre>
exit()
quit()
</pre>
Quits the S-Lang interpreter and returns to the
operating system 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="format91">
</a>format&nbsp;&nbsp;</b>

<pre>
Void format(String fmt)
</pre>
Sets the floating point output format to <tt>fmt</tt>. If given
as the nullstring (""), the default format is restored.
The default can be set by calling <tt>format</tt> from <tt>.vampssl</tt>,
else it is set to ``<tt>%6g</tt>''. (Using the S-Lang intrinsic
<tt>set_float_format</tt> is deprecated.)

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="fscanf91">
</a>fscanf&nbsp;&nbsp;</b>

<pre>
..., Integer scanf(String *fmt)
..., Integer fscanf(Integer fid, String *fmt)
..., integer sscanf(String *str, String *fmt)
</pre>
Formatted variable assignment like their C counterparts
(see <tt>scanf(3)</tt>), except that the assigned values, followed
by the number of assignments are placed on the stack. For
example:

<pre>
    variable month, day;
    if(sscanf("December, 5\n", "%[A-Z a-z], %d\n") == 2)
    {
        (month, day) = ();
        ...
    }
</pre>
pushes a string followed by an integer on the stack.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="getarg91">
</a>getarg&nbsp;&nbsp;</b>

<pre>
String getarg()
</pre>
Returns a string holding the next command line argument or
``<tt>-</tt>'' if there are no options left. Increases the internal
index to the command line arguments each time it is called.
For example:

<pre>
    variable arg;
    while(arg = getarg(), strcmp("--", arg))
    {
        ...
    }
</pre>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="getdefar91">
</a>getdefar&nbsp;&nbsp;</b>

<pre>
String getdefstr(section, name, def, fname, exitonerror)
Int getdefint(section, name, def, fname, exitonerror)
Float getdefdoub(section, name, def, fname, exitonerror)
Int, Array getdefar(section, name, fname, exitonerror)
</pre>
A series of functions te get information from Vamps input/output files.

<p>
They get the value for variable <tt>name</tt> in section <tt>section</tt>
of the file <tt>fname</tt>. If <tt>exitonerror</tt> ! =  0 then the
program is terminated if <tt>name</tt> is not found in <tt>section</tt>.
If <tt>exitonerror</tt>  =  =  0 and <tt>name</tt> is not found <tt>def</tt> is
returned instead.
<tt>getdefar</tt> is somewhat different. Is does not allow a <tt>def</tt>
variable and return either one or two values. It always returns
the number of points read. If zero
points are read no array is returned.

<p>
Say we use the following file (named ex.inp):

<pre>
[example]
examplename = nonsense
</pre>
And then call the <tt>getdefstr</tt> function like this:

<pre>
variable exn = getdefstr("example","examplename","Not found","ex.inp",0);
</pre>
the variable exn will now hold the string "nonsense".

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="getdefdoub91">
</a>getdefdoub&nbsp;&nbsp;</b>

<pre>
String getdefstr(section, name, def, fname, exitonerror)
Int getdefint(section, name, def, fname, exitonerror)
Float getdefdoub(section, name, def, fname, exitonerror)
Int, Array getdefar(section, name, fname, exitonerror)
</pre>
A series of functions te get information from Vamps input/output files.

<p>
They get the value for variable <tt>name</tt> in section <tt>section</tt>
of the file <tt>fname</tt>. If <tt>exitonerror</tt> ! =  0 then the
program is terminated if <tt>name</tt> is not found in <tt>section</tt>.
If <tt>exitonerror</tt>  =  =  0 and <tt>name</tt> is not found <tt>def</tt> is
returned instead.
<tt>getdefar</tt> is somewhat different. Is does not allow a <tt>def</tt>
variable and return either one or two values. It always returns
the number of points read. If zero
points are read no array is returned.

<p>
Say we use the following file (named ex.inp):

<pre>
[example]
examplename = nonsense
</pre>
And then call the <tt>getdefstr</tt> function like this:

<pre>
variable exn = getdefstr("example","examplename","Not found","ex.inp",0);
</pre>
the variable exn will now hold the string "nonsense".

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="getdefint91">
</a>getdefint&nbsp;&nbsp;</b>

<pre>
String getdefstr(section, name, def, fname, exitonerror)
Int getdefint(section, name, def, fname, exitonerror)
Float getdefdoub(section, name, def, fname, exitonerror)
Int, Array getdefar(section, name, fname, exitonerror)
</pre>
A series of functions te get information from Vamps input/output files.

<p>
They get the value for variable <tt>name</tt> in section <tt>section</tt>
of the file <tt>fname</tt>. If <tt>exitonerror</tt> ! =  0 then the
program is terminated if <tt>name</tt> is not found in <tt>section</tt>.
If <tt>exitonerror</tt>  =  =  0 and <tt>name</tt> is not found <tt>def</tt> is
returned instead.
<tt>getdefar</tt> is somewhat different. Is does not allow a <tt>def</tt>
variable and return either one or two values. It always returns
the number of points read. If zero
points are read no array is returned.

<p>
Say we use the following file (named ex.inp):

<pre>
[example]
examplename = nonsense
</pre>
And then call the <tt>getdefstr</tt> function like this:

<pre>
variable exn = getdefstr("example","examplename","Not found","ex.inp",0);
</pre>
the variable exn will now hold the string "nonsense".

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="getdefstr91">
</a>getdefstr&nbsp;&nbsp;</b>

<pre>
String getdefstr(section, name, def, fname, exitonerror)
Int getdefint(section, name, def, fname, exitonerror)
Float getdefdoub(section, name, def, fname, exitonerror)
Int, Array getdefar(section, name, fname, exitonerror)
</pre>
A series of functions te get information from Vamps input/output files.

<p>
They get the value for variable <tt>name</tt> in section <tt>section</tt>
of the file <tt>fname</tt>. If <tt>exitonerror</tt> ! =  0 then the
program is terminated if <tt>name</tt> is not found in <tt>section</tt>.
If <tt>exitonerror</tt>  =  =  0 and <tt>name</tt> is not found <tt>def</tt> is
returned instead.
<tt>getdefar</tt> is somewhat different. Is does not allow a <tt>def</tt>
variable and return either one or two values. It always returns
the number of points read. If zero
points are read no array is returned.

<p>
Say we use the following file (named ex.inp):

<pre>
[example]
examplename = nonsense
</pre>
And then call the <tt>getdefstr</tt> function like this:

<pre>
variable exn = getdefstr("example","examplename","Not found","ex.inp",0);
</pre>
the variable exn will now hold the string "nonsense".

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="hist91">
</a>hist&nbsp;&nbsp;</b>

<pre>
Void hist()
</pre>
Prints the history of command entered at the interactive
prompt to the screen.

<p>
Note that the  help operator `?' is never added to the list.
The excecute operator <tt>\</tt><tt>is replaced by </tt>()  =  evalfile(&#228;rg");@.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="interpreter91">
</a>interpreter&nbsp;&nbsp;</b>

<pre>
Void interpreter(int verb)
</pre>
Start the Vamps interactive mode. If <tt>verb</tt> ! =  0
the opening banner will be shown.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="makeindex91">
</a>makeindex&nbsp;&nbsp;</b>

<pre>
Int makeindex(filename)
</pre>
Makes an index (in memory) of file <tt>filename</tt>. It is usefull
to speed up random access to large vamps output files. Use
<tt>saveindex</tt> to save the index to a file.

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="maqend91">
</a>maqend&nbsp;&nbsp;</b>

<pre>
Void maqend(int maq_m)
</pre>
Cleans up after <tt>maqinit</tt>

<p>
from: <tt>../src/maq.lib/marquard.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="maqhead91">
</a>maqhead&nbsp;&nbsp;</b>

<pre>
Void maqhead()
</pre>
prints startup options of the <tt>maqrun</tt> procedure to
stderr

<p>
from: <tt>../src/maq.lib/marquard.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="maqinit91">
</a>maqinit&nbsp;&nbsp;</b>

<pre>
Int maqinit(int m, int n)
</pre>
Initializes the fitting system. n is the number of
parameters to use, m the number of points used in the
fitting process.

<p>
Returns 0 on success, -1 on error

<p>
from: <tt>../src/maq.lib/marquard.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="maqrun91">
</a>maqrun&nbsp;&nbsp;</b>

<pre>
Int maqrun()
</pre>
Runs the fitting procedure with the current settings
The S-Lang function <tt>Int fitf(Array par[], Int m, Int n)</tt> which
sets the <tt>rv[]</tt> array should be defined and working. It should return
0 if successfull and 1 if the function could not be resolved with
the supplied values for <tt>par[]</tt>.

<p>
Returns 0 on success

<p>
from: <tt>../src/maq.lib/marquard.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="maqtail91">
</a>maqtail&nbsp;&nbsp;</b>

<pre>
Void maqtail()
</pre>
prints exit info of the <tt>maqrun</tt> procedure to
stderr

<p>
from: <tt>../src/maq.lib/marquard.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="mread91">
</a>mread&nbsp;&nbsp;</b>

<pre>
Array mread(String file, Integer nc)
</pre>
Reads a matrix (2D floating point array) from the named
ascii <tt>file</tt>, which is supposed to consist of lines with
numerical fields separated by whitespace (spaces, TABS
and/or newlines). Lines starting with `<tt>#</tt>' or `<tt>%</tt>' are
considered comments; blank lines are skipped. If <tt>nc</tt><font face=symbol> &gt; </font
>0,
the number of matrix columns are set to <tt>nc</tt>. If <tt>nc</tt> is
zero or less, the number of columns are set equal to the
number of fields in the input lines. The number of matrix
rows are calculated from dividing the number of values by
the number of lines in the input <tt>file</tt>.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="mwrite91">
</a>mwrite&nbsp;&nbsp;</b>

<pre>
Void mwrite(Array m, String fname)
</pre>
Writes the double matrix <tt>m</tt> to an ascii file
Returns nothing;

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="opendef91">
</a>opendef&nbsp;&nbsp;</b>

<pre>
Int opendef (String fname)
</pre>
open a file for processing, close with closedef()

<p>
Returns: 0 on error, otherwise 1

<p>
Remarks: Opendef is used to speed up processing of files that are used
in a _sequential_ way. If files must be accessed randomely <tt>rinimem</tt>
or <tt>readindex</tt> should be used

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="pause91">
</a>pause&nbsp;&nbsp;</b>

<pre>
Void pause(Integer n)
</pre>
Suspends processing for <tt>n</tt> seconds, if <tt>n</tt> is positive. If
<tt>n</tt> is less than or equals zero, processing waits until a key
is pressed on the keyboard for which the user is prompted on
standard error.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="plt91">
</a>plt&nbsp;&nbsp;</b>

<pre>
Void plt_close()
</pre>
Closes the pipe to the plotting program

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="plt\_close91">
</a>plt_close&nbsp;&nbsp;</b>

<pre>
Void plt_close()
</pre>
Closes the pipe to the plotting program

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="prompt91">
</a>prompt&nbsp;&nbsp;</b>

<pre>
String prompt(String str1, String str2)
</pre>
Sets the prompts used in interactive mode. Default prompts
are ``<tt>Slash<font face=symbol> &gt; </font
> </tt>'' and ``<tt>_Slash<font face=symbol> &gt; </font
> </tt>''. If either argument
is the nullstring (<tt>""</tt>), that prompt is not changed. The
sequences <tt>%#</tt> and <tt>%$</tt> are translated to the current input
line number and stack depth respectively.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="quit91">
</a>quit&nbsp;&nbsp;</b>

<pre>
exit()
quit()
</pre>
Quits the S-Lang interpreter and returns to the
operating system 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="readindex91">
</a>readindex&nbsp;&nbsp;</b>

<pre>
Int readindex(filename)
</pre>
Reads an index previously save with <tt>saveindex</tt>.

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="readset91">
</a>readset&nbsp;&nbsp;</b>

<pre>
Int readset(String filename, String setname)
</pre>
Reads set <tt>setname</tt> from file <tt>fname</tt>. Returns the
id of the set or -1 on error.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="save\_history91">
</a>save_history&nbsp;&nbsp;</b>

<pre>
Int save_history(fname)
</pre>
Save the command entered at the interactive prompt to the
file <tt>fname</tt>. Returns -1 on error (this file could not be
opened in write mode) and 0 on success.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="saveindex91">
</a>saveindex&nbsp;&nbsp;</b>

<pre>
Int saveindex(filename)
</pre>
Save the index to the file <tt>filename</tt>.

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="scanf91">
</a>scanf&nbsp;&nbsp;</b>

<pre>
..., Integer scanf(String *fmt)
..., Integer fscanf(Integer fid, String *fmt)
..., integer sscanf(String *str, String *fmt)
</pre>
Formatted variable assignment like their C counterparts
(see <tt>scanf(3)</tt>), except that the assigned values, followed
by the number of assignments are placed on the stack. For
example:

<pre>
    variable month, day;
    if(sscanf("December, 5\n", "%[A-Z a-z], %d\n") == 2)
    {
        (month, day) = ();
        ...
    }
</pre>
pushes a string followed by an integer on the stack.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="scrcols91">
</a>scrcols&nbsp;&nbsp;</b>

<pre>
Integer scrcols
Integer scrrows
</pre>
Readonly variables set to the number of (text) columns and
rows of the screen. These values change when the window
size changes.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="scrrows91">
</a>scrrows&nbsp;&nbsp;</b>

<pre>
Integer scrcols
Integer scrrows
</pre>
Readonly variables set to the number of (text) columns and
rows of the screen. These values change when the window
size changes.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="setidx91">
</a>setidx&nbsp;&nbsp;</b>

<pre>
void sl_setidx(char *idxname);
</pre>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="sl\_met\_init91">
</a>sl_met_init&nbsp;&nbsp;</b>

<pre>
Void sl_met_init
</pre>
Initializes the meteo functions:
<tt>eaes, vslope, e0b</tt>

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="slpath91">
</a>slpath&nbsp;&nbsp;</b>

<pre>
String slpath(String str)
</pre>
Sets a colon (`<tt>:</tt>') separated pathlist of directories to
search when loading S-Lang command files (using <tt>autoload</tt>
and <tt>evalfile</tt>).  If <tt>str</tt> is the nullstring (<tt>""</tt>), the
pathlist is not changed. The returned string holds the
previous pathlist.

<p>
Within a pathlist specification, a single dot (`<tt>.</tt>') denotes
the current working directory. If the first character of
a path in the list is the tilde (`<tt><tt>~</tt></tt>'), it is expanded to
the home directory obtained from the <tt>HOME</tt> environment
variable. For example, if the user maintains a library of
S-Lang command files in a directory <tt>$HOME/lib/vamps</tt>,
the command:

<pre>
    () = slpath(strcat("~/lib/vamps:", slpath("")));
</pre>
can be placed in the <tt>.vampssl</tt> file in the user's home
directory. Script files, however, should restore the
previous pathlist before terminating.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="sreadline91">
</a>sreadline&nbsp;&nbsp;</b>

<pre>
Int sreadline
</pre>
If this variable is 1 vamps runs in interactive mode (readline
initialized.). If this is set to 0 pressing <tt>^</tt>C causes Vamps to
switch to interactive mode on unix systems. 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="sscanf91">
</a>sscanf&nbsp;&nbsp;</b>

<pre>
..., Integer scanf(String *fmt)
..., Integer fscanf(Integer fid, String *fmt)
..., integer sscanf(String *str, String *fmt)
</pre>
Formatted variable assignment like their C counterparts
(see <tt>scanf(3)</tt>), except that the assigned values, followed
by the number of assignments are placed on the stack. For
example:

<pre>
    variable month, day;
    if(sscanf("December, 5\n", "%[A-Z a-z], %d\n") == 2)
    {
        (month, day) = ();
        ...
    }
</pre>
pushes a string followed by an integer on the stack.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="strv91">
</a>strv&nbsp;&nbsp;</b>

<pre>
Array strv(String str, String sep)
</pre>
Splits the string <tt>str</tt> into fields separated by one or
more characters from the string <tt>sep</tt>. A terminating
newline is always considered a field separator. Returns a
vector (1D array) of strings set to the individual fields.
For example:

<pre>
    variable fid, i, s, v;
    fid = fopen("my_file.dat", "r");
    while(fgets(fid) &#62; 0)
    {
        s = ();
        v = strv(s, " \t");
        for(i = 0; i &lt; asize(v); i++)
            printf("%16s\n", v[i], 1);
    }
</pre>
reads an entire data file of fields separated by runs of
whitespace characters and prints the fields on standard
output.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="tty91">
</a>tty&nbsp;&nbsp;</b>

<pre>
Integer tty
</pre>
Readonly variable set to <tt>1</tt> if standard output is a tty, <tt>2</tt>
if standard input is a tty, <tt>3</tt> if both standard input and
output are connected to a tty, else set to <tt>0</tt>.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_cumbot91">
</a>v_cumbot&nbsp;&nbsp;</b>

<pre>
Float v_cumbot
</pre>
Cumulative flow trough bottom of profile calculated from start of
simulation (Read only)

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_cumeva91">
</a>v_cumeva&nbsp;&nbsp;</b>

<pre>
Float v_cumeva
</pre>
Cumulative evaporation (from wet canopy) (Read only) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_cumintc91">
</a>v_cumintc&nbsp;&nbsp;</b>

<pre>
Float v_cumint
</pre>
Cumulative interception [cm] (Read only) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_cumprec91">
</a>v_cumprec&nbsp;&nbsp;</b>

<pre>
Float v_cumprec
</pre>
Cumulative precipitation [cm] (Read only) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_cumtop91">
</a>v_cumtop&nbsp;&nbsp;</b>

<pre>
Float v_cumtop
</pre>
Cumulative flow trough top of profile calculated from start of
simulation (Read only)

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_cumtra91">
</a>v_cumtra&nbsp;&nbsp;</b>

<pre>
Float v_cumtra
</pre>
Cumulative transpiration. This is equal to <tt>v_rootextract</tt> if
transpiration reduction is not calculated (Read only) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_dt91">
</a>v_dt&nbsp;&nbsp;</b>

<pre>
Float v_dt
</pre>
Current timestep in interation process. The 'real' timeste can
be found in the <tt>v_thiststep</tt> variable (in days) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_getspar91">
</a>v_getspar&nbsp;&nbsp;</b>

<pre>
Float v_getspar(int nr, char *des)
</pre>
Gets parameter from soil description structure

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_masbal91">
</a>v_masbal&nbsp;&nbsp;</b>

<pre>
Float v_masbal
</pre>
mass balance error in %. Read only.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_postsoil91">
</a>v_postsoil&nbsp;&nbsp;</b>

<pre>
Void v_postsoil
</pre>
Cleans up after the soil module

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_presoil91">
</a>v_presoil&nbsp;&nbsp;</b>

<pre>
Void v_presoil()
</pre>
Initialize the soil moisture module

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_printstr91">
</a>v_printstr&nbsp;&nbsp;</b>

<pre>
Void v_printstr(name, str)
</pre>
Stores variable <tt>str</tt> with name <tt>name</tt> in the output-file.
This function can be used in the <tt>each_step</tt> function only.
It's purpose is to store extra information in the output-file.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_printsum91">
</a>v_printsum&nbsp;&nbsp;</b>

<pre>
Void v_printsum()
</pre>
Prints actual water balance summary at <tt>stderr</tt> 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_qbot91">
</a>v_qbot&nbsp;&nbsp;</b>

<pre>
Float v_qbot
</pre>
Flow trough bottom of profile for current timestep (Read only)

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_qtop91">
</a>v_qtop&nbsp;&nbsp;</b>

<pre>
Float v_qtop
</pre>
Flow trough top of profile for current timestep (Read only) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_rootextract91">
</a>v_rootextract&nbsp;&nbsp;</b>

<pre>
Float v_rootextract
</pre>
Cumulative amount of water extracted by the roots (actual
transpiration) (Read only) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_setspar91">
</a>v_setspar&nbsp;&nbsp;</b>

<pre>
Void v_setspar(int nr, char *des, val double)
</pre>
set parameter in soil description structure

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_smd91">
</a>v_smd&nbsp;&nbsp;</b>

<pre>
Float v_smd
</pre>
Soil moisture deficit for current timestep in cm 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_steps91">
</a>v_steps&nbsp;&nbsp;</b>

<pre>
Int v_steps
</pre>
Number of steps in the current simulation (Read,only) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_t91">
</a>v_t&nbsp;&nbsp;</b>

<pre>
Float v_t
</pre>
Current time in simulation (in days) 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_volact91">
</a>v_volact&nbsp;&nbsp;</b>

<pre>
Float v_volact
</pre>
Actual water content of the total soil profile [cm] (Read only)

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_volsat91">
</a>v_volsat&nbsp;&nbsp;</b>

<pre>
Float v_volsat
</pre>
Water content of the soil profile at saturation (read only)

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="v\_vpd91">
</a>v_vpd&nbsp;&nbsp;</b>

<pre>
Float v_vpd
</pre>
Actual vapour pressure deficit in mbar (Read only)

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="vamps\_help91">
</a>vamps_help&nbsp;&nbsp;</b>
Void vamps_help(String key)

<p>
gets help on <tt>key</tt>. See <tt>'?'</tt> for further info.

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="verbose91">
</a>verbose&nbsp;&nbsp;</b>

<pre>
Int verbose
</pre>
The general verbose level in the current simulation. 0 is quiet. A
higher the number makes Vamps more verbose. Verbose levels above 1
are usefull for debugging only 

<p>
from: <tt>../src/main/init_s.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="version91">
</a>version&nbsp;&nbsp;</b>

<pre>
Integer version
</pre>
Readonly variable holding the current <tt>slash</tt> version number
multiplied by 100.

<p>
from: <tt>../src/main/intrins.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>

<b><a NAME="writememini91">
</a>writememini&nbsp;&nbsp;</b>

<pre>
Int writememini(fname, inifname)
</pre>
Writes the file read into memory with the <tt>rinmem</tt> function
to a file. If <tt>fname</tt> is "-" output is send to stdout.
inifname if the name of the file in memory.

<p>
from: <tt>../src/deffile.lib/sl_inter.c</tt>

<p>
from file: <tt>intrin.doc</tt>

<p>
        <H2><A NAME="tth_sEc9.2">
9.2</A>&nbsp;&nbsp;User defined functions (written in <b>S-Lang</b>)</H2>

<p>

<b><a NAME="cat92">
</a>cat&nbsp;&nbsp;</b>

<pre>
Void cat(inf, outf)
</pre>
Copies the file <tt>inf</tt> to <tt>outf</tt> appending it if
<tt>outf</tt> already exists. <tt>cat</tt> only works with ascii
files.

<p>
from file: <tt>cat.sl</tt>

<p>

<b><a NAME="e0a92">
</a>e0a&nbsp;&nbsp;</b>

<pre>
Float e0a(Td,Rs,sunratio,u,Ea,Es,Slope,Gamma,L)
</pre>
Returns: e0 in mm/day (i think)
The determination of $E_a$
is described in <tt>\</tt>cite{calder1990284}:
<tt>\</tt>begin{equation}
E_a  =  2.6  (e_s - e_a)  (1 + 0.537 u)
<tt>\</tt>end{equation}
<tt>\</tt>begin{where}
<tt>\</tt>Index{$e_a$}	&amp;	actual vapour pressure [mbar]<tt>\</tt><tt>\</tt>
<tt>\</tt>Index{$e_s$}	&amp;	vapour pressure at saturation [mbar]<tt>\</tt><tt>\</tt>
<tt>\</tt>Index{$u$}	&amp;	mean daily wind-speed at 2m<tt>\</tt><tt>\</tt>
<tt>\</tt>end{where}

<p>
from file: <tt>met.sl</tt>

<p>

<b><a NAME="e0b92">
</a>e0b&nbsp;&nbsp;</b>

<pre>
Float e0b(Td,Rs,Rsout,Rnet,u,Ea,Es,Slope,Gamma,L)
</pre>
Calculates penman open water evaporation using net radiation.
Use the <tt>delgam</tt> function to get Gamma, Slope, and L

<p>
Returns: e0 in mm/day (i think)

<p>
from file: <tt>met.sl</tt>

<p>

<b><a NAME="eaes92">
</a>eaes&nbsp;&nbsp;</b>

<pre>
Float,Float eaes(td,rh)
</pre>
Determines saturation vapour pressure (ea) and actual vapour presssure 
(ea) from relative humidity and dry bulb temperature. es is calculated
according to Bringfeld 1986. Relative humidity should be in % and
dry bulb temp in degrees Celcius. 
Example:

<pre>
variable ea,es;

(ea, es) = eaes(20.0,76);
printf("ea = %f es = %f\n",ea,es,2);
</pre>
Returns: ea, es

<p>
from file: <tt>met.sl</tt>

<p>

<b><a NAME="gamma92">
</a>gamma&nbsp;&nbsp;</b>

<pre>
Float gamma(td)
</pre>
Calculates the psychometric constant ([$mbar/{}<tt>^</tt>o K$])
It assumes an air pressure of 998mb. Cp is estimated
at 1005.0 J/kgK

<p>
Returns: psychrometric constant

<p>
from file: <tt>met.sl</tt>

<p>

<b><a NAME="makkink92">
</a>makkink&nbsp;&nbsp;</b>

<pre>
Float makkink(rad,Slope,Gamma)
</pre>
calculates reference evaporation according to Makkink
The C1 constant is taken as 0.65 and C2 0.0

<p>
Returns: makkink reference evaporation in mm/day

<p>
from file: <tt>met.sl</tt>

<p>

<b><a NAME="ra92">
</a>ra&nbsp;&nbsp;</b>

<pre>
Float ra (z, z0, d, u)
</pre>
Calculates ra (aerodynamic resistance) according to:

<pre>
    ra = [ln((z-d)/z0)]^2 /(k^2u)
    Where:
        d  = displacement height
        z  = height of the wind speed measurements
        u  = windspeed 
        z0 = roughness length
        k  = von Karman constant
</pre>
Returns: ra

<p>
from file: <tt>met.sl</tt>

<p>

<b><a NAME="vslope92">
</a>vslope&nbsp;&nbsp;</b>

<pre>
Float vslope(Td,es);
</pre>
Calculates the slope of the saturation vapour pressure 
curve from es and dry bulb temp for use in Penman Eo and
Penman-Montheith.  
Required input: Td (dry bulb temp [oC]), es

<p>
Returns: slope of the vapour pressure curve

<p>
from file: <tt>met.sl</tt>

<p>

<b><a NAME="endsubplot92">
</a>endsubplot&nbsp;&nbsp;</b>

<pre>
Void endsubplot()
</pre>
Resets the plotting system to single plot mode. Also needed to actually
draw the plot on some terminals. See also <tt>subplot</tt>.

<p>
from file: <tt>multplt.sl</tt>

<p>

<b><a NAME="pprint92">
</a>pprint&nbsp;&nbsp;</b>

<pre>
Void pprint()
</pre>
Print the current plot on a postscript printer

<p>
from file: <tt>multplt.sl</tt>

<p>

<b><a NAME="subplot92">
</a>subplot&nbsp;&nbsp;</b>

<pre>
Void subplot(x, y, index)
</pre>
Set the plotting system for multiple plots on one page. <tt>x</tt> and <tt>y</tt> are the
number of plots in the x and y direction respectively. <tt>index</tt> denotes the
number of the subplot in which the next plot is drawn. Numbering starts
at one.  The first plot is drawn in the upper left corner, the last in the
lower right. Currently subplot only works with gnuplot. See also
<tt>endsubplot</tt>.

<p>
from file: <tt>multplt.sl</tt>

<p>

<b><a NAME="f\_plot92">
</a>f_plot&nbsp;&nbsp;</b>

<pre>
Void f_plot(String var,String  thef,Int xcol, Int ycol)
</pre>
Plots var <tt>var</tt> from vamps output file <tt>thef</tt>.
It does so by calling <tt>vsel</tt> to construct a matrix. This
matrix is than passed to <tt>m_plot</tt> to make the actual plot.
Column 0 is time.
See also <tt>plot</tt> and <tt>plot.sl</tt>.

<p>
from file: <tt>plot.sl</tt>

<p>

<b><a NAME="m\_plot92">
</a>m_plot&nbsp;&nbsp;</b>

<pre>
Void m_plot(Matrix m, Int xcol, Int ycol, String title, String xlab,
        String ylab)
</pre>
Plots an XY diagram of matrix <tt>m</tt> using the current graphics method.
Column numbering for <tt>xcol</tt> and <tt>ycol</tt> starts at zero. Depending on the
graphics method used the top, x and y-axis labels strings cannot be empty.
example:

<pre>
outputdev = 1; % screen graphics
m_plot(m,0,1,"Matrix m","Time","Q");
outputdev = 0; % Plot is OK, make hardcopy
m_plot(m,0,1,"Matrix m","Time","Q");
</pre>
See also <tt>plot</tt> and <tt>plot.sl</tt>.

<p>
from file: <tt>plot.sl</tt>

<p>

<b><a NAME="plot92">
</a>plot&nbsp;&nbsp;</b>

<pre>
plot.sl - high level plotting functions
</pre>
Plot functions to allow quick visualization of Vamps output files
and matrix variables. The syntax of the high level functions (<tt>f_plot</tt>
and <tt>m_plot</tt>) is the same, no matter which underlying graphics method
is used. Low level functions depend on the graphics method used. The
following graphics methods can be used:

<pre>
    plot        - gnu plotutils lib 1.1
    agl        - AGL graphics lib 3.?
    ext_plot    - using external gnu plotutils programs (UNIX only)    
    gnu_plot    - using gnuplot interface (UNIX only)    
              see also @#@ and @plt@.    
</pre>
Which of these methods can be used in this version of vamps is
printed to the screen when using the <tt>plot</tt> command to initialize the
plot system. The <tt>show_plotsys()</tt> function can be used for this purpose
as well.

<p>
The <tt>outputdev</tt> variable can be used to specify screen preview (1) or
hardcopy output (0).

<p>
If more than one graphics method is available you can switch between 
methods be setting the <tt>m_plot</tt> function to the method specific function.
Use the <tt>set_plotsys</tt> function to do so.

<p>
from file: <tt>plot.sl</tt>

<p>

<b><a NAME="plot.sl92">
</a>plot.sl&nbsp;&nbsp;</b>

<pre>
plot.sl - high level plotting functions
</pre>
Plot functions to allow quick visualization of Vamps output files
and matrix variables. The syntax of the high level functions (<tt>f_plot</tt>
and <tt>m_plot</tt>) is the same, no matter which underlying graphics method
is used. Low level functions depend on the graphics method used. The
following graphics methods can be used:

<pre>
    plot        - gnu plotutils lib 1.1
    agl        - AGL graphics lib 3.?
    ext_plot    - using external gnu plotutils programs (UNIX only)    
    gnu_plot    - using gnuplot interface (UNIX only)    
              see also @#@ and @plt@.    
</pre>
Which of these methods can be used in this version of vamps is
printed to the screen when using the <tt>plot</tt> command to initialize the
plot system. The <tt>show_plotsys()</tt> function can be used for this purpose
as well.

<p>
The <tt>outputdev</tt> variable can be used to specify screen preview (1) or
hardcopy output (0).

<p>
If more than one graphics method is available you can switch between 
methods be setting the <tt>m_plot</tt> function to the method specific function.
Use the <tt>set_plotsys</tt> function to do so.

<p>
from file: <tt>plot.sl</tt>

<p>

<b><a NAME="plotstyle92">
</a>plotstyle&nbsp;&nbsp;</b>

<pre>
Int plotstyle;
</pre>
Set the plotting style:

<pre>
0 = lines, 1 is markers, 2 = markers &amp; lines

from file: @plot.sl@
</pre>

<p>

<b><a NAME="set\_plotsys92">
</a>set_plotsys&nbsp;&nbsp;</b>

<pre>
Void set_plotsys(Int nr)
</pre>
Sets the uses plotting system to the system <tt>nr</tt>. It uses <tt>show_plotsys</tt>
to display the updated list of available plot-systems. If the <tt>plverb</tt>
variable is <font face=symbol> &gt; </font
> 1

<p>
from file: <tt>plot.sl</tt>

<p>

<b><a NAME="set\_plotsys\_byname92">
</a>set_plotsys_byname&nbsp;&nbsp;</b>

<pre>
Void set_plotsys_byname(String name)
</pre>
Sets the uses plotting system to the system <tt>name</tt>. It uses <tt>show_plotsys</tt>
to display the updated list of available plot-systems.

<p>
from file: <tt>plot.sl</tt>

<p>

<b><a NAME="show\_plotsys92">
</a>show_plotsys&nbsp;&nbsp;</b>

<pre>
Void show_plotsys
</pre>
Prints short descriptions of all the installed plotting systems
to the screen. The system indicated with a '*' is the active system.

<p>
from file: <tt>plot.sl</tt>

<p>

<b><a NAME="plotpar92">
</a>plotpar&nbsp;&nbsp;</b>

<pre>
Void plotpar("parname")
</pre>
calls <tt>vsel</tt> and <tt>graph</tt> to plot parameter <tt>parname</tt> from <tt>outfilename</tt>.

<p>
from file: <tt>runut.sl</tt>

<p>

<b><a NAME="plotts92">
</a>plotts&nbsp;&nbsp;</b>

<pre>
Int plotts("tsname");
</pre>
plots a time serie from the start of the run to
current time 't' using the current plot settings

<p>
Returns: nothing

<p>
from file: <tt>runut.sl</tt>

<p>

<b><a NAME="savets92">
</a>savets&nbsp;&nbsp;</b>

<pre>
Int savets ("tsname", "fname", points)
</pre>
saves the time series tsname to the file fname from
point 0 to point points

<p>
Returns: -1 on failure, 0 on sucess

<p>
from file: <tt>runut.sl</tt>

<p>

<b><a NAME="v\_save\_all\_sets92">
</a>v_save_all_sets&nbsp;&nbsp;</b>

<pre>
Void v_save_all_sets ()
</pre>
save all currently loaded datasets to a file. The
filenames are created by prepending 'set_' to the name of
the dataset

<p>
from file: <tt>runut.sl</tt>

<p>

<b><a NAME="v\_show\_data\_sets92">
</a>v_show_data_sets&nbsp;&nbsp;</b>

<pre>
Void v_show_data_sets ();
</pre>
shows all data set currently loaded

<p>
Returns: nothing

<p>
from file: <tt>runut.sl</tt>

<p>

<b><a NAME="adev92">
</a>adev&nbsp;&nbsp;</b>

<pre>
Array adev(Array mtx)
</pre>
Returns a row vector with the absolute mean deviations for
each column in <tt>mtx</tt>.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="corr92">
</a>corr&nbsp;&nbsp;</b>

<pre>
Array corr(Array mtx)
</pre>
Calculate linear correlation coefficient (r) between x-data in
column 0 and y-data in subsequent columns.

<p>
Returns a row vector with correlation coefficients for each
column in <tt>mtx</tt> w.r.t. column 0. Hence, Array[0,0]  =  1.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="covar92">
</a>covar&nbsp;&nbsp;</b>

<pre>
Array covar(Array mtx)
</pre>
Calculates the covariance between x-data in <tt>mtx</tt> column 0 and
y-data in subsequent columns.

<p>
Returns a row vector with covariances for each column in <tt>mtx</tt>
w.r.t. column 0. Hence, Array[0,0] contains the variance of the
data in the first column.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="linreg92">
</a>linreg&nbsp;&nbsp;</b>

<pre>
Array linreg(Array mtx)
</pre>
Calculates linear regression coefficients for straight line
fitting, i.e: y  =  Ax + B. A is slope and B is y-intercept.
Argument is minimum 2*2 matrix, regression is performed for
all <tt>mtx</tt> columns j<font face=symbol> &gt; </font
> = 1 (y-data) against column 0 (x-data).

<p>
Returns a 2*n matrix in which for each column j in <tt>mtx</tt>,
Array[0,j]  =  A and Array[1,j]  =  B. Hence, Array[0,0]  =  1 and
Array[1,0]  =  0.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="mean92">
</a>mean&nbsp;&nbsp;</b>

<pre>
Array mean(Array mtx)
</pre>
Returns a row vector with the mean values for each column
in <tt>mtx</tt>.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="median92">
</a>median&nbsp;&nbsp;</b>

<pre>
Array median(Array mtx)
</pre>
Returns a row vector with the median values for each column
in <tt>mtx</tt>.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="mmax92">
</a>mmax&nbsp;&nbsp;</b>

<pre>
Array mmax(Array mtx)
</pre>
Returns a row vector with the maximum values for each column
in <tt>mtx</tt>.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="mmin92">
</a>mmin&nbsp;&nbsp;</b>

<pre>
Array mmin(Array mtx)
</pre>
Returns a row vector with the minimum values for each column
in <tt>mtx</tt>.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="rmsq92">
</a>rmsq&nbsp;&nbsp;</b>

<pre>
Array rmsq(Array mtx)
</pre>
Returns a row vector with the root mean square or quadratic
mean values for each column in <tt>mtx</tt>.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="sdev92">
</a>sdev&nbsp;&nbsp;</b>

<pre>
Array sdev(Array mtx)
</pre>
Returns a row vector with the standard deviations for each
column in <tt>mtx</tt>.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="stats92">
</a>stats&nbsp;&nbsp;</b>

<pre>
Void stats
</pre>
Initialize statistical data analysis library. None of the
functions in <tt>stats.sl</tt> can be used before this command is
issued.

<p>
All statistical data analysis is performed on matrices (2D
floating point arrays) in which the data are column-wise
organized.

<p>
from file: <tt>stats.sl</tt>

<p>

<b><a NAME="tstep\_top92">
</a>tstep_top&nbsp;&nbsp;</b>

<pre>
tstep_top(tstepje)
</pre>
Calculates soilevaporation, potential transpiration, interception
and precipitation for each step at <tt>tstepje</tt>.

<p>
Return order should be:
return(soilevap, pot-trans, intercep, precipitation);

<p>
from file: <tt>topsys.sl</tt>

<p>

<b><a NAME="f\_save92">
</a>f_save&nbsp;&nbsp;</b>

<pre>
Void f_save(String var, String filename, String outfilename)
</pre>
Writes the variable <tt>var</tt> from the vamps outputfile <tt>filename</tt> to
an ascii file <tt>outfilename</tt>. Depending on the nature of the variable
two ore more columns are created. The time data resides in the
first column.

<p>
from file: <tt>util.sl</tt>

<p>

<b><a NAME="usergetstr92">
</a>usergetstr&nbsp;&nbsp;</b>

<pre>
char *usergetstr(char *prompt);
</pre>
Gets a string from user, resets tty for use in interactive 
mode, the global variable userstr_l gives the length of the 
user string. see also <tt>Slang_reset_tty</tt> and <tt>SLang_init_tty</tt>

<p>
If the first character of the string is a <tt>':'</tt> the remaining
part of the string is passed to <tt>system()</tt>;

<p>
If the first character of the string is a <tt>'?'</tt> the remaining
part of the string is passed to <tt>vamps_help()</tt>;

<pre>
If the first character of the string is a '@' the remaining
</pre>
part of the string is passed to <tt>eval()</tt>;

<p>
Returns: string

<p>
from file: <tt>util.sl</tt>

<p>

<b><a NAME="vprof92">
</a>vprof&nbsp;&nbsp;</b>

<pre>
[Array], Int  vprof(String var, Float time, String filename)
</pre>
Returns -1 on failure or the number of rows
in the array and the array on success.

<p>
vprof reads a profile variable from the Vamps output file
<tt>filename</tt> for a single timstep (time) in the simulation.
Depth is placed in column 1 and the value in column 0.
See also <tt>vsel</tt>

<p>
from file: <tt>util.sl</tt>

<p>

<b><a NAME="vsel92">
</a>vsel&nbsp;&nbsp;</b>

<pre>
[array], Int vsel (parname, layer, filename)
</pre>
Returns -1 on failure or the number of rows
in the array and the array on success.
If <tt>layer  =  =  -1</tt> then all layers are put into
the array.
Example:

<pre>
variable ar;
if (vsel("volact",-1,"sat.out") != -1){
    ar = ();
}
</pre>
See also the stand-alone <tt>vsel</tt> program and <tt>vprof</tt>.

<p>
from file: <tt>util.sl</tt>

<p>

<b><a NAME="adim92">
</a>adim&nbsp;&nbsp;</b>

<pre>
Integer adim(Array arr)
Integer, ... asize(Array arr)
Integer atype(Array arr)
</pre>
Give information about array arr. adim returns the array
dimension (1, 2 or 3), asize returns the size for each
dimension and atype returns the data type of the array.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="apropos92">
</a>apropos&nbsp;&nbsp;</b>

<pre>
apropos(String substring)
</pre>
apropos prints all functions and variables containing <tt>substring</tt> to
stdout. It assumes the <tt>print()</tt> intrinsic

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="asize92">
</a>asize&nbsp;&nbsp;</b>

<pre>
Integer adim(Array arr)
Integer, ... asize(Array arr)
Integer atype(Array arr)
</pre>
Give information about array arr. adim returns the array
dimension (1, 2 or 3), asize returns the size for each
dimension and atype returns the data type of the array.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="at\_end92">
</a>at_end&nbsp;&nbsp;</b>

<pre>
Void at_end()
</pre>
The vamps s-lang end function. Place extra stuff you want to
have done at the end of simulation in this function.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="at\_start92">
</a>at_start&nbsp;&nbsp;</b>

<pre>
Void at_start()
</pre>
This is the vamps s-lang startup function. It can be completely empty
if you want. The default shows all the data sets in memory.
Place extra stuff you want to
have done at startup in this function.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="atype92">
</a>atype&nbsp;&nbsp;</b>

<pre>
Integer adim(Array arr)
Integer, ... asize(Array arr)
Integer atype(Array arr)
</pre>
Give information about array arr. adim returns the array
dimension (1, 2 or 3), asize returns the size for each
dimension and atype returns the data type of the array.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="debug92">
</a>debug&nbsp;&nbsp;</b>

<pre>
Void debug()
</pre>
Alias for <tt>print_stack</tt>, prints the present contents of the S-Lang
stack to stdout

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="each\_step92">
</a>each_step&nbsp;&nbsp;</b>

<pre>
Void each_step()
</pre>
The vamps S-Lang function that is executed after each timestep. 
Place extra stuff you want to have done after each timestep in 
this function. Normally this function is defined in <tt>vamps.sl</tt> but
it can be redefined in any S-Lang file that is loaded by <tt>Vamps</tt>.
It's default definition is as follows:

<pre>
    define each_step ()
    {
       % Check for conditional switches to interactive mode, see stop.sl
       stop();
       v_printstr("CPU",string(cpu)); % Store CPU time used in output file
    }

from file: @vamps.sl@
</pre>

<p>

<b><a NAME="echo92">
</a>echo&nbsp;&nbsp;</b>

<pre>
Void echo(obj)
</pre>
Prints an ascii representation of obj, followed by a newline
on standard output. Supported are: Character, Float, Integer,
String, and 1D and 2D Arrays for these types.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="fprintf92">
</a>fprintf&nbsp;&nbsp;</b>

<pre>
Void printf(String fmt, ..., Integer N)
Void fprintf(Integer fp, String fmt, ..., Integer N)
String sprintf(String fmt, ..., Integer N)
</pre>
Formatted printing cf. the C printf family, except that
the number of parameters N must be given. printf and
fprintf return nothing, sprintf returns the formatted
string.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="help92">
</a>help&nbsp;&nbsp;</b>

<pre>
Void help()
</pre>
Prints short info on the Vamps interactive mode. See also '?'

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="linspace92">
</a>linspace&nbsp;&nbsp;</b>

<pre>
Array linspace(Float x0, Float x1, Integer n)
</pre>
Returns a vector of <tt>n</tt> elements with linearly spaced intervals
between <tt>x0</tt> and <tt>x1</tt>.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="logspace92">
</a>logspace&nbsp;&nbsp;</b>

<pre>
Array logspace(Float x0, Float x1, Integer n)
</pre>
Returns a vector of <tt>n</tt> elements with logarithmically spaced intervals
between 1E<tt>x0</tt> and 1E<tt>x1</tt>.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="matrix92">
</a>matrix&nbsp;&nbsp;</b>

<pre>
Array matrix(Integer m, Integer n)
</pre>
Returns a matrix (two-dimensional floating point array)
with <tt>m</tt> rows and <tt>n</tt> columns. All elements are set to zero.
A row vector is created with <tt>m = 1</tt>, a column vector is created
with <tt>n = 1</tt>. Elements are addressed by [<tt>i,j</tt>], where <tt>0<font face=symbol> &lt; </font
> = i<font face=symbol> &lt; </font
>m</tt>
and <tt>0<font face=symbol> &lt; </font
> = j<font face=symbol> &lt; </font
>n</tt>.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="printf92">
</a>printf&nbsp;&nbsp;</b>

<pre>
Void printf(String fmt, ..., Integer N)
Void fprintf(Integer fp, String fmt, ..., Integer N)
String sprintf(String fmt, ..., Integer N)
</pre>
Formatted printing cf. the C printf family, except that
the number of parameters N must be given. printf and
fprintf return nothing, sprintf returns the formatted
string.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="sprintf92">
</a>sprintf&nbsp;&nbsp;</b>

<pre>
Void printf(String fmt, ..., Integer N)
Void fprintf(Integer fp, String fmt, ..., Integer N)
String sprintf(String fmt, ..., Integer N)
</pre>
Formatted printing cf. the C printf family, except that
the number of parameters N must be given. printf and
fprintf return nothing, sprintf returns the formatted
string.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="transpose92">
</a>transpose&nbsp;&nbsp;</b>

<pre>
Array transpose(Array mtx)
</pre>
Returns a transposed matrix of <tt>mtx</tt>. The returned matrix is
a new one, the elements of <tt>mtx</tt> are left unchanged.

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="ts\_echo92">
</a>ts_echo&nbsp;&nbsp;</b>

<pre>
Void ts_echo(obj)
</pre>
Prints an ascii representation of obj, followed by a newline
on standard output. Supported are: Character, Float, Integer,
String, and 1D and 2D Arrays for these types. In this case
all floats and first columns of matrixes are regarded in <tt>ts(5)</tt>
format

<p>
from file: <tt>vamps.sl</tt>

<p>

<b><a NAME="v\_run92">
</a>v_run&nbsp;&nbsp;</b>

<pre>
Void v_run(String inf)
</pre>
Starts a Vamps run with input file <tt>inf</tt>.

<p>
from file: <tt>vamps.sl</tt>

<p>
     <br><H1>Part 3   <br>Case studies</H1><br>

<p>
      <H1><A NAME="tth_chAp10">
Chapter 10     </A><br>Introduction</H1>
Several studies in which the  Vamps&nbsp;model has been used are
presented in the following chapters. It is hoped that this
not only gives a good idea about  Vamps' capabilities, but
will also help the user when working with the program.
To give an idea of the
possible uses of vamps I will shortly describe three (semi-realistic)
cases and how  Vamps&nbsp;can cope with these cases:

<OL type="1">
<p>

<li>A small lysimeter located in west Java, Indonesia worked most of the
time. However discharge data from several days is
missing. Transpiration, interception en soil-evaporation fluxes are
already calculated (and measured) by other means. In this case  Vamps&nbsp;is used to estimate the discharge for the missing days.
To simulate the lysimeter as accurate as possible  Vamps&nbsp;is
used with a no flow bottom boundary and lateral flow allowed
only on the bottom soil node.

<li>
<p>
Fiji ...
</OL>
<p>
      <H1><A NAME="tth_chAp11">
Chapter 11     </A><br>A <em>Pinus caribaea</em> plantation forest</H1><A NAME="chap:fiji">
</A>

        <H2><A NAME="tth_sEc11.1">
11.1</A>&nbsp;&nbsp;Introduction</H2>
This chapter shows the results of running  Vamps&nbsp;on a dataset
concerning a <em>Pinus caribaea</em> plantation forest, located on Viti
Levu, Fiji (see&nbsp;). A 61 days period (July 2
- September 2) from the Tulasewa site was modeled using
meteorological data with a 30 minute resolution. The soils at this
site have a bulk density ranging from 0.97 at the top to 1.07 g/cm
at 1.2 m below the surface. Saturated hydraulic conductivity was
determined for three soil layers from 29 core samples (See
Table&nbsp;).  determined van
Genuchten parameters for the topsoil (0 - 30cm) and the subsoil (30
- 150cm) using 12 and 17 samples respectively. These values (see
Table&nbsp;) were used in the soil section of the  Vamps&nbsp;model without any modification.

<p>
Transpiration was modeled using the Penman Montheith combination
equation while interception was modeled using an adapted version of
the Gash model<a href="#tthFtNtADA" name=tthFrefADA><sup>30</sup></a>. Soil evaporation was modeled by using
the Penman Montheith combination equation as well. It was assumed that
net radiation at the forest floor was 3.5 % of that at the top
of the canopy. 

<p>
To verify model results measured values of moisture content were used.
All values were obtained using a capacitance probe<a NAME="capacitance probe111">
</a>. 

<p>

<p><A NAME="tth_tAb11.1">
</A> 
<table><tr><td>
<tr><td>Soil layer </td><td>Porosity </td><td>Alpha </td><td>K<sub>sat</sub>[cm/day] </td><td>n </td><td>Depth [cm] </td>
<tr><td>1	</td><td>0.6 </td><td>0.061 </td><td>1800 </td><td>1.098 </td><td>0 - 30 </td>
<tr><td>2	</td><td>0.61 </td><td>0.042 </td><td>380 	</td><td>1.094 </td><td>30 - 75 </td>
<tr><td>3	</td><td>0.61 </td><td>0.042 </td><td>0.03  </td><td>1.094 </td><td>70 - 150 </td><tr><td></td></table>

<A NAME="tab:tul-soil">
</A>

<p>
 <center>      Table 11.1: Soil physical parameters from to Tulasewa site used as input 
for  Vamps</center>
<p>
<p>
        <H2><A NAME="tth_sEc11.2">
11.2</A>&nbsp;&nbsp;Results</H2>
The water balance summary for the modeled period is shown
int Table&nbsp;.

<p><A NAME="tth_tAb11.2">
</A> 
<p>

<center>
<table><tr><td>
<tr><td>Parameter </td><td>Value </td>
<tr><td>Initial water volume of profile </td><td>71.765  </td>
<tr><td>Saturated water volume of profile </td><td>98.397 </td>
<tr><td>Total precipitation </td><td>25.767 </td>
<tr><td>Total transpiration </td><td>16.753 </td>
<tr><td>Total interception </td><td>5.261 </td>
<tr><td>Total soilevaporation </td><td>1.522 </td>
<tr><td>Total rootextraction </td><td>10.693 </td>
<tr><td>Total drainage </td><td>-0.008 </td>
<tr><td>Total surface_runoff </td><td>0.000 </td>
<tr><td>Initial storage </td><td>71.765 </td>
<tr><td>Final storage </td><td>80.197 </td>
<tr><td>Change in storage </td><td>-8.432 </td>
<tr><td>Percent mass-balance err </td><td>-0.039 </td><tr><td></td></table>

</center><br>
<p>
<A NAME="tab:watbalfiji">
</A> <center>      Table 11.2: Summary of modeled water balance results for the period
July 2 - September 7</center>
<p>
<p>
The modeled interception and transpiration values are similar to those
presented by . Canopy resistance (R<sub>s</sub>)
was calculated using the relations derived by
<a href="#tthFtNtADB" name=tthFrefADB><sup>31</sup></a>. Calculated potential transpiration however, could not
be maintained over this period due to modeled water stress.
Calculated root-extraction (actual modeled transpiration) was 5.5 cm
lower. This may be caused by several factors: <em>(1)</em> The regression
equations used to estimate R<sub>s</sub> were obtained for a wetter period
in which the trees did not suffer water stress. <em>(2)</em> The water
content versus suction-head functions are not very accurate in the drier
regions, and may be overestimating the suction-head in those regions.

<p>
The average moisture content is generally modeled with good result 
(Figure&nbsp;, bottom part). The the upper layers
the low moisture contents (theta  <font face=symbol>£</font
>  0.3). One reason for this is the
the pF related to a moisture content of 0.3 is already beyond 4.2.

<p>

<p><A NAME="tth_fIg11.1">
</A> 
<center><a href="figure=psfig/mesmod1.eps">Figure</a></center><br><A NAME="fig:mesmodtheta1">
</A> <center>      Figure 11.1: Measured (plus signs) and modeled (line) water content for layers 
at 6, 22 and 42 cm. below the surface</center>
<p>
<p>

<p><A NAME="tth_fIg11.2">
</A> 
<center><a href="figure=psfig/mesmod2.eps">Figure</a></center><br><A NAME="fig:mesmodtheta2">
</A> <center>      Figure 11.2: Measured (plus signs) and modeled (line) water content for layers 
at 80 and 104 cm. The bottom figure shows measured and modeled average water content.</center>
<p>
<p>

<p><A NAME="tth_fIg11.3">
</A> 
<center><a href="figure=psfig/watbal1.eps">Figure</a></center><br><A NAME="fig:watbal1">
</A> <center>      Figure 11.3: </center>
<p>
<p>

<p><A NAME="tth_fIg11.4">
</A> 
<center><a href="figure=psfig/watbal2.eps">Figure</a></center><br><A NAME="fig:watbal2">
</A> <center>      Figure 11.4: </center>
<p>
<p>
2
<font size="-4">
<p>

<pre>
[vamps]
iniinmem=1

[run]
outputfile = run5.hh.out

[determine]
canopy = 1
soilmoisture = 1

[time]
steps = 2930

[ts]
precipitation=../ninp/precip.prn
netrad=../ninp/rnet.prn
rhumid = ../ninp/rh.prn
temp=../ninp/newt.prn
windspeed = ../ninp/wind.prn
sm_probe_avg_theta = ../ninp/theta.mes.ts

[xout]
filename= xout.arn

[interception]
method = 0
# These are pre-cyclone values
E_avg/R = 0.147
p_f = 0.6
p_tr = 0.017
S = 0.08
St = 0.0062

[canopy]
transpiration = 2
Rnet_absorb = 0.975
method = 2
layers = 1
#ra=7.0
z = 12.7
z_0 = 1.5
d = 7.0

[roots]
swsink = 0
swhypr = 0
swupfu = 0
depth = 120.0
hlim1 = -5.0
hlim2u = -50.0
hlim2l = -50.0
hlim3h = -800.0
hlim3l = -1000.0
hlim3 = -1800.0
hlim4 = -12000.0

[soil]
swredu=0
cofred= 0.35
smooth=12
gwlevel = 1.0
outdir = output
pondmx = 0.0
verbose=1
layers= 77
bottom= 6
initprof = 0
theta_initial = 0.200000 0.210000 0.220000 0.220000 0.265000\
0.300000 0.350000 0.375817 0.377095 0.383497\
0.380000 0.380000 0.380000 0.443651 0.400000\
0.400000 0.400000 0.400000 0.410000 0.420000\
0.430000 0.440000 0.470000 0.470000 0.470000\
0.470000 0.470000 0.544194 0.470000 0.470000\
0.460000 0.460000 0.460000 0.460000 0.582024\
0.460000 0.460000 0.460000 0.460000 0.460000\
0.460000 0.514537 0.506907 0.506545 0.505096\
0.504733 0.495707 0.489597 0.492829 0.501117\
0.505820 0.499311 0.497508 0.497508 0.497508\
0.497508 0.497508 0.497508 0.497508 0.497508\
0.497508 0.497508 0.497508 0.497508 0.497508\
0.497508 0.497508 0.497508 0.497508 0.497508\
0.497508 0.497508 0.497508 0.497508 0.497508\
0.497508 0.497508 

# This is from page 70 phd waterloo
# total depth = 2.000000
[layer_0]
description = Tulasewa top layer
thickness=2.000000
theta_initial=0.2
method =1
thetas =0.6
theta_residual = 0.08
thickness = 2.5
alpha = 0.061
n = 1.098
l=0.5
ksat=1800

# total depth = 30.000000
[layer_14]
description = Tulasewa 30 - 75 cm layer
thickness=2.000000
theta_initial=0.4
thetas = 0.64
alpha = 0.042
n = 1.094
l = 0.5
ksat=380.0

# total depth = 74.000000
[layer_36]
description = Tulsewa deep layer &#62; 75 cm
thickness=2.000000
theta_initial=0.46
ksat = 3.0
thetas = 0.6
</pre>
</font>
<p>
<a name="tth_sEcindex"></a>

<H2> Index (showing section)</H2>
<hr><H3>Footnotes:</H3>

<p><a name=tthFtNtAAB></a><a href="#tthFrefAAB"><sup>1</sup></a> At the moment  Vamps runs on several operating
systems including  unix&nbsp;(Sun- os, Linux, Net- bsd&nbsp;and  aix)
 ms-dos&nbsp;and  OS/2
<p><a name=tthFtNtAAC></a><a href="#tthFrefAAC"><sup>2</sup></a> Currently the swap/swatr program is maintained and
documented in by: Dept. of Agrohydrology, Winand Staring Centre
and Dept. of Water Resources, Wageningen Agricultural University
<p><a name=tthFtNtAAD></a><a href="#tthFrefAAD"><sup>3</sup></a> As the
bottom boundary conditions can also change in time one could probably
regard this as a driving force as well
<p><a name=tthFtNtAAE></a><a href="#tthFrefAAE"><sup>4</sup></a> As the bottom boundary conditions can also change in
time one could probably regard this as a driving force as well
<p><a name=tthFtNtAAF></a><a href="#tthFrefAAF"><sup>5</sup></a> An
air-pressure of 998 mbar is assumed in calculating <font face=symbol>g</font
>
<p><a name=tthFtNtAAG></a><a href="#tthFrefAAG"><sup>6</sup></a> The settings for the input file that control interception are described in section&nbsp; on
page&nbsp;.
<p><a name=tthFtNtAAH></a><a href="#tthFrefAAH"><sup>7</sup></a>  Vamps
, the final version, can estimate litter interception as a seperate
term
<p><a name=tthFtNtAAI></a><a href="#tthFrefAAI"><sup>8</sup></a> Although the word canopy implies a forest most of the
methods described here can also be applied to agricultural crops or
grassland
<p><a name=tthFtNtAAJ></a><a href="#tthFrefAAJ"><sup>9</sup></a> This is also true for  Vamps
<p><a name=tthFtNtABA></a><a href="#tthFrefABA"><sup>10</sup></a> The latter is
generally preferable as the penman-Monteith equation (in this case
with R<sub>s</sub> set to zero) in not very good at predicting in storm
evaporation.  This seems to be due to the influence of advective
energy during a storm. Usually [<font face=symbol>`</font
>E]/[<font face=symbol>`</font
>R] is
determined by a regression of interception losses versus gross
precipitation including only single storm events.
<p><a name=tthFtNtABB></a><a href="#tthFrefABB"><sup>11</sup></a> And changed
to my liking
<p><a name=tthFtNtABC></a><a href="#tthFrefABC"><sup>12</sup></a> the use of
lookup tables can in certain circumstances also cause some speed
increase
<p><a name=tthFtNtABD></a><a href="#tthFrefABD"><sup>13</sup></a> A version of topog_soil for the
 Vamps&nbsp;model will be available in the future
<p><a name=tthFtNtABE></a><a href="#tthFrefABE"><sup>14</sup></a> The numbers between brackets
denote the value of the <tt>bottom</tt> variable in the <tt>soil</tt>
section needed
<p><a name=tthFtNtABF></a><a href="#tthFrefABF"><sup>15</sup></a> Using <b>S-Lang</b> it should be fairly easy to write custom
postprocess-functions. For example the following command gets the
variable <tt>volact</tt> from an output file for all timesteps and
write a two column ascii file that can be read into spreadsheet
software: <tt>mwrite(getts("volact","vamps_output_file",-1),"columnfile");</tt>

<p><a name=tthFtNtABG></a><a href="#tthFrefABG"><sup>16</sup></a> Dramatically might be a better word
as I found out myself
<p><a name=tthFtNtABH></a><a href="#tthFrefABH"><sup>17</sup></a> A MS-DOS port of the GNU C/C++
compiler which I used to create the .EXE files.
<p><a name=tthFtNtABI></a><a href="#tthFrefABI"><sup>18</sup></a> A freeware  dpmi
server is included in the distribution. Note that a windows or OS/2
MS-DOS box can also provide  dpmi service.
<p><a name=tthFtNtABJ></a><a href="#tthFrefABJ"><sup>19</sup></a> Time series files must contain two columns, time and
value. Lines starting with # are regarded as comments (see <b>
ts(5))</b>.
<p><a name=tthFtNtACA></a><a href="#tthFrefACA"><sup>20</sup></a> Actually <b>nodes</b> would be a better name for this
variable
<p><a name=tthFtNtACB></a><a href="#tthFrefACB"><sup>21</sup></a> The use of this preprocessor is described in a
seperate manual
<p><a name=tthFtNtACC></a><a href="#tthFrefACC"><sup>22</sup></a> The character itself is converted to a
space
<p><a name=tthFtNtACD></a><a href="#tthFrefACD"><sup>23</sup></a> If you want you can change this character using the 
<tt>commentchar</tt> variable in the <tt>vamps</tt> section or the -C
command-line option.  Usually there should be no reason to do so
<p><a name=tthFtNtACE></a><a href="#tthFrefACE"><sup>24</sup></a> See also the -&nbsp;-Header option in  Vamps&nbsp;(1)
<p><a name=tthFtNtACF></a><a href="#tthFrefACF"><sup>25</sup></a> This will change in the beta
version in which time-steps will be determined by the time column in the
input file
<p><a name=tthFtNtACG></a><a href="#tthFrefACG"><sup>26</sup></a> This implies that a comma
is <em>not</em> allowed in a filename
<p><a name=tthFtNtACH></a><a href="#tthFrefACH"><sup>27</sup></a> 
see also section&nbsp;<A href="#sec:physlay">5.5</A> on page&nbsp;<A href="#sec:physlay">pageref</A>
<p><a name=tthFtNtACI></a><a href="#tthFrefACI"><sup>28</sup></a> actually the all important thing here is
how fast your compiler/CPU combo can execute the pow() function
as this usually account for 90% of the CPU time!
<p><a name=tthFtNtACJ></a><a href="#tthFrefACJ"><sup>29</sup></a> Used in the ts section
and the -&nbsp;-Output option.
<p><a name=tthFtNtADA></a><a href="#tthFrefADA"><sup>30</sup></a> This version of Gash is described in the
 Vamps&nbsp;model documentation
<p><a name=tthFtNtADB></a><a href="#tthFrefADB"><sup>31</sup></a> See Example&nbsp; which actually lists
this function
<p><hr><small>File translated from T<sub><font size="-1">E</font></sub>X by <a href="http://hutchinson.belmont.ma.us/tth/">T<sub><font size="-1">T</font></sub>H</a>, version 2.00.<br>On  1 Feb 1999, 13:59.</small>
</HTML>
